version: '3.8'

services:
  trusted-data-agent:
    # This 'build' section tells Compose to use your Dockerfile
    build:
      context: . # Assumes Dockerfile is in this directory
      dockerfile: Dockerfile
    # This will be the name of the image after it's built
    image: trusted-data-agent-v10:latest
    
    # This is the container name from your JSON config
    container_name: trusted-data-agent-v10
    
    # This 'command' overrides the default CMD in the Dockerfile
    # It's taken directly from the "cmd" field in your JSON
    command: python -m trusted_data_agent.main --host 0.0.0.0 --port 5000
    
    # Port mapping not needed with host network mode
    # The container will listen on port 5000 on the host directly
    # ports:
    #   - "5050:5000"
      
    volumes:
      # Mount the entire application directory for development
      # IMPORTANT: Ensure /volume2/docker/trusted-data-agent-v10 contains your latest code
      # including all fixes for authentication and configuration
      - /volume2/docker/trusted-data-agent-v10:/app
      
    environment:
      # Application-specific variables
      - CORS_ALLOWED_ORIGINS=https://tda.uderia.com
      
    # Using host network mode to access MCP server directly
    # This shares the host's network stack with the container
    network_mode: host
      
    # This is a high-risk setting from your JSON ("privileged": true).
    # It gives the container root access to your host machine.
    privileged: true
    
    # Your JSON had "enable_restart_policy": false, which means 'no' restart.
    # For production, you might want to change this to "unless-stopped".
    restart: "no"

# Network section commented out when using host network mode
# networks:
#   tda_network:
#     driver: bridge
#     name: TDA_Network