<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trusted Data Agent</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@antv/g2plot@latest/dist/g2plot.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<!-- MODIFICATION: Body remains the 100vh flex-col container -->
<body class="flex h-screen flex-col bg-dark-bg text-light-text" data-theme="legacy">

    <!-- MODIFICATION: These are now top-level. The wrappers are removed. -->
    <nav class="w-full bg-black/30 backdrop-blur-md border-b border-white/10 py-2 flex items-center justify-between flex-shrink-0 z-40">
        <div class="flex items-center gap-x-4">
            <!-- NEW: Hamburger menu toggle aligned with sidebar icons -->
            <div class="w-[88px] pl-4 flex items-center flex-shrink-0">
                <button id="app-menu-toggle" type="button" class="p-3 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
            <!-- Title - refined typography -->
            <h1 class="header-title text-lg font-medium text-white tracking-tight">Trusted Data Agent</h1>
            <!-- GitHub Star Button -->
            <a href="https://github.com/rgeissen/trusted-data-agent" target="_blank" rel="noopener noreferrer" 
               class="flex items-center gap-x-2 px-3 py-1.5 bg-white/10 hover:bg-white/20 border border-white/20 rounded-md transition-all duration-200 text-sm font-medium text-gray-200 hover:text-white"
               title="Star this project on GitHub">
                <svg id="github-star-icon" class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                    <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Z"></path>
                </svg>
                <span>Star</span>
                <span id="github-star-count" class="px-2 py-0.5 bg-black/30 rounded-md text-xs font-semibold">-</span>
            </a>
            <!-- Status message area -->
            <div id="header-status-message" class="text-sm px-3 py-1 rounded-md transition-all duration-300 opacity-0"></div>
            <!-- Configuration Persistence Warning Banner (Application Level) -->
            <div id="persistence-warning-banner" class="hidden flex items-center gap-x-2 px-3 py-1.5 bg-cyan-500/20 border border-cyan-400/40 rounded-md text-xs text-cyan-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
                <span class="font-medium">Demo Mode: Credentials are not stored permanently</span>
            </div>
            <!-- Example: Add more application-level banners here if needed -->
            <!-- <div id="some-other-app-banner" class="hidden ...">...</div> -->
        </div>
        <div class="flex items-center gap-x-4">
            <!-- Status Dots (MOVED HERE) -->
            <div class="flex items-center gap-x-4">
                <div class="flex items-center gap-x-2" title="MCP Server Status">
                    <div id="mcp-status-dot" class="connection-dot disconnected"></div>
                    <span class="text-sm text-gray-300">MCP</span>
                </div>
                <div class="flex items-center gap-x-2" title="RAG Status">
                    <div id="rag-status-dot" class="connection-dot disconnected"></div>
                    <span class="text-sm text-gray-300">RAG</span>
                </div>
                <div class="flex items-center gap-x-2" title="LLM Status">
                    <div id="llm-status-dot" class="connection-dot disconnected"></div>
                    <span class="text-sm text-gray-300">LLM</span>
                </div>
                <div class="flex items-center gap-x-2" title="Real-time Connection Status">
                    <div id="sse-status-dot" class="connection-dot disconnected"></div>
                    <span class="text-sm text-gray-300">SSE</span>
                </div>
                <div class="flex items-center gap-x-2" title="Context Engine Status - Click to purge Context">
                    <div id="context-status-dot" class="connection-dot disconnected"></div>
                    <span class="text-sm text-gray-300">Context</span>
                </div>
            </div>
            <!-- User Menu (Authentication) -->
            <div id="user-menu-container" class="menu-item relative hidden">
                <button id="user-menu-button" class="flex items-center gap-x-2 p-2 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10" title="User Menu">
                    <div class="w-9 h-9 rounded-full bg-gradient-to-br from-[#F15F22] to-[#D9501A] flex items-center justify-center text-white font-bold text-sm shadow-lg ring-2 ring-white/20">
                        <span id="user-avatar-initial">?</span>
                    </div>
                    <span id="user-display-name" class="text-sm font-medium hidden md:block">Guest</span>
                </button>
                <div id="user-dropdown-menu" class="dropdown-menu mt-2 w-56 rounded-md shadow-lg p-1" style="background-color: var(--modal-bg); border: 1px solid var(--border-primary); backdrop-filter: blur(16px);">
                    <div class="px-3 py-2 mb-1" style="border-bottom: 1px solid var(--border-primary);">
                        <p class="text-sm font-medium text-white" id="user-menu-name">User</p>
                        <p class="text-xs text-gray-400" id="user-menu-email">user@example.com</p>
                    </div>
                    <button id="user-profile-button" class="flex items-center w-full px-3 py-2 text-sm text-gray-200 rounded-md text-left" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                        Profile
                    </button>
                    <button id="user-change-password-button" class="flex items-center w-full px-3 py-2 text-sm text-gray-200 rounded-md text-left" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                        </svg>
                        Change Password
                    </button>
                    <button id="settings-info-button" class="flex items-center w-full px-3 py-2 text-sm text-gray-200 rounded-md text-left" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                        </svg>
                        Info
                    </button>
                    <div class="my-1" style="border-top: 1px solid var(--border-primary);"></div>
                    <!-- Theme Selector -->
                    <div class="px-3 py-2">
                        <p class="text-xs text-gray-400 mb-2">Theme</p>
                        <div class="flex gap-2">
                            <button id="theme-legacy" class="theme-selector flex-1 px-2 py-1.5 text-xs text-gray-200 rounded border transition-colors" data-theme="legacy" style="border-color: var(--border-primary);" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                                Legacy
                            </button>
                            <button id="theme-modern" class="theme-selector flex-1 px-2 py-1.5 text-xs text-gray-200 rounded border transition-colors" data-theme="modern" style="border-color: var(--border-primary);" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                                Modern
                            </button>
                        </div>
                    </div>
                    <div class="my-1" style="border-top: 1px solid var(--border-primary);"></div>
                    <button id="user-logout-button" class="flex items-center w-full px-3 py-2 text-sm text-red-400 rounded-md hover:bg-red-500/10 text-left">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" />
                        </svg>
                        Logout
                    </button>
                </div>
            </div>
            <!-- Login Button (shown when not authenticated) -->
            <div id="login-button-container" class="hidden">
                <a href="/login" class="flex items-center gap-x-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    Login
                </a>
            </div>
        </div>
    </nav>
    
    <!-- MODIFICATION: These are now top-level. The wrappers are removed. -->
    <div id="main-content-area" class="flex flex-row flex-1 min-h-0">
        
        <!-- NEW: Vertical Side Navigation Bar -->
        <nav id="app-side-nav" class="collapsed flex flex-col h-full bg-black/30 p-4 border-r border-white/10 space-y-4">
            <!-- Navigation Links -->
            <div class="flex flex-col space-y-2">
                <!-- Reordered: Conversation first, then Executions, RAG Maintenance, Marketplace, and Credentials last -->
                <a href="#" id="view-switch-conversation" data-view="conversation-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7S2 13.866 2 10 5.582 3 10 3s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zm-4 0H9v2h2V9z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-link-text font-semibold">Conversations</span>
                </a>
                <!-- NEW: Executions View Link -->
                <a href="#" id="view-switch-executions" data-view="executions-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M3 3h14v2H3V3zm0 4h14v10H3V7zm2 2v6h2v-6H5zM9 9v4h2V9H9zM13 9v4h2V9h-2z" />
                    </svg>
                    <span class="nav-link-text font-semibold">Executions</span>
                </a>
                <a href="#" id="view-switch-rag-maintenance" data-view="rag-maintenance-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4z" />
                        <path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-link-text font-semibold">RAG Maintenance</span>
                </a>
                <!-- NEW: RAG Marketplace View Link -->
                <a href="#" id="view-switch-rag-marketplace" data-view="rag-marketplace-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <!-- Marketplace/store icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span class="nav-link-text font-semibold">Marketplace</span>
                </a>
                <a href="#" id="view-switch-credentials" data-view="credentials-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-link-text font-semibold">Credentials</span>
                </a>
                <a href="#" id="view-switch-admin" data-view="admin-view" class="view-switch-button hidden flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-link-text font-semibold">Administration</span>
                </a>
            </div>
        </nav>

        <!-- NEW: Main View Container (holds all swappable views) -->
        <main id="app-view-container" class="flex-1 h-full min-w-0">

            <!-- VIEW 1: Conversation -->
            <!-- MODIFICATION: Set as initial active view -->
            <div id="conversation-view" class="app-view active flex flex-col w-full h-full">
                
                <!-- NEW: Conversation View Header (contains status dots and config/info buttons) -->
                <header id="conversation-header" class="hidden w-full bg-black/10 border-b border-white/10 px-4 py-2 flex items-center justify-between flex-shrink-0 z-10">
                    <!-- LEFT: Active Session Title and Profile Indicators -->
                    <div id="active-session-title-wrapper" class="hidden flex items-center gap-x-3">
                        <span id="active-session-title" class="text-lg font-semibold text-white cursor-pointer" title="Click to rename session">Current Session</span>
                        <span id="active-session-title-editing-hint" class="text-xs text-gray-400 hidden">Press Enter to save, Esc to cancel</span>
                        <!-- Copy Icon -->
                        <button id="copy-session-id" class="text-gray-400 hover:text-[#F15F22] transition-colors" title="Copy Session ID">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                        <!-- Divider -->
                        <div class="h-6 w-px bg-white/20"></div>
                        <!-- Default Profile Badge -->
                        <div id="header-default-profile" class="hidden flex items-center gap-x-2 px-3 py-1 rounded-lg backdrop-blur-md border border-white/20">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                            </svg>
                            <span id="header-default-profile-tag" class="text-sm font-semibold text-white"></span>
                            <span class="text-xs text-white/70">default</span>
                        </div>
                        <!-- Temporary Override Badge -->
                        <div id="header-override-profile" class="hidden flex items-center gap-x-2 px-3 py-1 rounded-lg backdrop-blur-md border-2 animate-pulse-border">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
                            </svg>
                            <span id="header-override-profile-tag" class="text-sm font-semibold text-white"></span>
                            <span class="text-xs text-white/70">override</span>
                        </div>
                        <!-- Profile Override Failure Warning (Inline in header) -->
                        <div id="profile-override-warning-banner" class="hidden flex items-center gap-x-2 px-3 py-1 rounded-md bg-yellow-500/20 border border-yellow-400/50">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                            <span id="profile-override-warning-message" class="text-xs text-yellow-100 font-medium"></span>
                            <button id="dismiss-profile-warning" class="text-yellow-400 hover:text-yellow-200 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <!-- RIGHT: Config/Info/Window Buttons -->
                    <div class="flex items-center gap-x-1">
                        <div class="menu-item">
                            <button id="chat-modal-button" class="px-3 py-2 text-sm font-semibold text-gray-300 hover:bg-white/10 rounded-md transition-colors disabled:opacity-50" disabled>Chat</button>
                        </div>
                        <!-- MODIFICATION: Removed Config Button -->
                        <div class="menu-item">
                            <button id="prompt-editor-button" class="px-3 py-2 text-sm font-semibold text-gray-300 hover:bg-white/10 rounded-md transition-colors disabled:opacity-50" disabled>System Prompt</button>
                        </div>
                        <div class="menu-item">
                            <button id="window-menu-button" class="px-3 py-2 text-sm font-semibold text-gray-300 hover:bg-white/10 rounded-md transition-colors">Window</button>
                            <div id="window-dropdown-menu" class="dropdown-menu mt-2 w-56 rounded-md shadow-lg glass-panel p-1">
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>History Panel</span>
                                    <input type="checkbox" id="toggle-history-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>Capabilities Panel</span>
                                    <input type="checkbox" id="toggle-header-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>Status Panel</span>
                                    <input type="checkbox" id="toggle-status-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                                <div class="my-1 border-t border-white/10"></div>
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>Show Tooltips</span>
                                    <input type="checkbox" id="toggle-tooltips-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                                <div class="my-1 border-t border-white/10"></div>
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>Show Welcome Screen</span>
                                    <input type="checkbox" id="toggle-welcome-screen-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- NEW: Wrapper for the 3-panel layout -->
                <div id="conversation-panels" class="flex flex-row flex-1 min-h-0">
                    <!-- Original 3-Panel Layout (History, Main, Status) -->
                    <aside id="session-history-panel" class="collapsed w-1/4 max-w-xs h-full flex-col glass-panel rounded-r-2xl shadow-2xl border-r border-white/10" data-requires-config="true">
                        <header class="p-4 border-b border-white/10 flex justify-between items-center flex-shrink-0">
                            <h2 class="header-title text-lg font-bold text-white">History</h2>
                            <button id="new-chat-button" type="button" title="Start New Chat" class="p-2 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10">
                                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                            </button>
                        </header>
                        <div id="session-list" class="flex-1 p-2 overflow-y-auto space-y-2">
                            <!-- Session items will be dynamically added here -->
                        </div>
                    </aside>

                    <div id="main-content" class="flex flex-col h-full flex-1 min-w-0 relative">
                        <div id="top-buttons-container" class="absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-30 pointer-events-none hidden" data-requires-config="true">
                            <button id="toggle-history-button" title="Toggle History Panel" class="p-2 rounded-full bg-gray-800/50 hover:bg-teradata-orange transition-colors pointer-events-auto">
                                <!-- History Expand/Collapse Icons -->
                                <svg id="history-expand-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                                </svg>
                                <svg id="history-collapse-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                                </svg>
                            </button>
                            <button id="toggle-header-button" title="Toggle Capabilities Panel" class="p-2 rounded-full bg-gray-800/50 hover:bg-teradata-orange transition-colors pointer-events-auto">
                                <!-- Header Expand/Collapse Icons -->
                                <svg id="header-collapse-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" />
                                </svg>
                                <svg id="header-expand-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <button id="toggle-status-button" title="Toggle Status Panel" class="p-2 rounded-full bg-gray-800/50 hover:bg-teradata-orange transition-colors pointer-events-auto">
                                <!-- Status Expand/Collapse Icons -->
                                <svg id="status-collapse-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                                </svg>
                                <svg id="status-expand-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>

                        <header id="tool-header" class="relative rounded-b-2xl shadow-2xl z-20 flex flex-col flex-shrink-0 border-b pt-16 collapsed" style="background: var(--sidebar-bg, rgba(36, 52, 71, 0.98)); border-color: var(--sidebar-border, rgba(148, 163, 184, 0.1));" data-requires-config="true">
                            <!-- Capabilities Panel Content -->
                            <nav id="resource-tabs" class="flex justify-center items-center gap-x-4 p-3 border-b border-white/10">
                                <button class="resource-tab px-4 py-2 font-semibold text-sm text-gray-300 transition-colors hover:text-white active" data-type="tools">Tools</button>
                                <button class="resource-tab px-4 py-2 font-semibold text-sm text-gray-300 transition-colors hover:text-white" data-type="prompts">Prompts</button>
                                <button class="resource-tab px-4 py-2 font-semibold text-sm text-gray-300 transition-colors hover:text-white" data-type="resources">Resources</button>
                            </nav>
                            <div id="panels-container" class="flex-1 min-h-0">
                                <div id="tools-panel" class="resource-panel flex flex-col h-full">
                                    <nav id="tools-categories" class="flex justify-center items-center gap-x-2 p-3 border-b border-white/10"></nav>
                                    <div id="tools-panels-container" class="flex-1 min-h-0 overflow-y-auto p-2"></div>
                                </div>
                                <div id="prompts-panel" class="resource-panel flex-col h-full" style="display: none;">
                                    <nav id="prompts-categories" class="flex justify-center items-center gap-x-2 p-3 border-b border-white/10"></nav>
                                    <div id="prompts-panels-container" class="flex-1 min-h-0 overflow-y-auto p-2"></div>
                                </div>
                                <div id="resources-panel" class="resource-panel flex-col h-full" style="display: none;">
                                    <nav id="resources-categories" class="flex justify-center items-center gap-x-2 p-3 border-b border-white/10"></nav>
                                    <div id="resources-panels-container" class="flex-1 min-h-0 overflow-y-auto p-2"></div>
                                </div>
                            </div>
                        </header>

                        <div class="flex-1 flex flex-col min-h-0">
                            <main id="chat-container" class="flex-1 overflow-y-auto p-6">
                                <!-- Welcome Screen for Unconfigured State -->
                                <div id="welcome-screen" class="hidden h-full overflow-y-auto">
                                    <div class="max-w-5xl mx-auto text-center space-y-12 p-4 sm:p-8 pb-20 pt-12 sm:pt-20">
                                        <!-- Logo/Icon with gradient glow -->
                                        <div class="flex justify-center welcome-hero-icon">
                                            <div class="w-20 h-20 sm:w-28 sm:h-28 glass-panel rounded-3xl flex items-center justify-center shadow-2xl flex-shrink-0 border border-white/20 welcome-icon-container">
                                                <!-- Simple lightning bolt representing speed: "From Days to Seconds" -->
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 sm:h-16 sm:w-16 welcome-lightning" fill="#F15F22" viewBox="0 0 24 24">
                                                    <path d="M13 3L4 13h7l-1 7 9-10h-7l1-7z" />
                                                </svg>
                                            </div>
                                        </div>
                                        
                                        <!-- Heading with gradient text -->
                                        <div class="space-y-4">
                                            <h1 class="text-5xl sm:text-6xl font-bold text-white header-title">Trusted Data Agent</h1>
                                            <p class="text-2xl sm:text-3xl text-gray-300 font-medium">A Paradigm Shift in Data Interaction</p>
                                            <p class="text-xl sm:text-2xl font-bold mt-4 welcome-gradient-text">Go from question to insight to action in seconds</p>
                                        </div>
                                        
                                        <!-- Description -->
                                        <p class="text-gray-400 text-xl leading-relaxed max-w-2xl mx-auto">
                                            To get started, configure your connection settings and experience 
                                            a new way to interact and operate with your data ecosystem.
                                        </p>
                                        
                                        <!-- CTA Button -->
                                        <div class="flex flex-col items-center gap-6 pt-4">
                                            <button id="welcome-configure-btn" class="welcome-cta-button group relative px-8 py-3.5 bg-teradata-orange hover:bg-teradata-orange-dark text-white text-lg font-semibold rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center gap-3">
                                                <!-- Animated glow effect -->
                                                <div class="welcome-button-glow"></div>
                                                <!-- Cogwheel Icon (spins during connection) -->
                                                <svg id="welcome-cogwheel-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 relative z-10 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                </svg>
                                                <span id="welcome-button-text" class="relative z-10">Start Conversation</span>
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 relative z-10 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                                                </svg>
                                            </button>
                                            <div class="flex flex-col items-center gap-2">
                                                <p class="text-sm text-gray-400 welcome-subtext">(Requires MCP + Google/OpenAI/Llama/Azure AI/Ollama)</p>
                                                <a href="#" id="welcome-reconfigure-link" class="text-sm text-gray-400 hover:text-white transition-colors hidden">
                                                    or reconfigure settings
                                                </a>
                                            </div>
                                        </div>
                                        
                                        <!-- Features Grid with hover effects -->
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-16 pt-12 border-t border-white/10">
                                            <div class="welcome-feature-card glass-panel p-6 rounded-2xl space-y-3 transition-all duration-300 hover:shadow-2xl group">
                                                <div class="w-14 h-14 rounded-xl flex items-center justify-center mx-auto transition-transform duration-300 group-hover:scale-110" style="background-color: rgba(241, 95, 34, 0.25);">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="var(--teradata-orange)" viewBox="0 0 24 24">
                                                        <path d="M13 3L4 13h7l-1 7 9-10h-7l1-7z" />
                                                    </svg>
                                                </div>
                                                <h3 class="text-white font-bold text-lg header-title">Actionable</h3>
                                                <p class="text-base text-gray-400 leading-relaxed">From discovery to automation in seconds - zero friction</p>
                                            </div>
                                            <div class="welcome-feature-card glass-panel p-6 rounded-2xl space-y-3 transition-all duration-300 hover:shadow-2xl group">
                                                <div class="w-14 h-14 bg-[#10b981]/20 rounded-xl flex items-center justify-center mx-auto transition-transform duration-300 group-hover:scale-110 group-hover:bg-[#10b981]/30">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-[#10b981]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                                    </svg>
                                                </div>
                                                <h3 class="text-white font-bold text-lg header-title">Transparent</h3>
                                                <p class="text-base text-gray-400 leading-relaxed">See every step - no AI black box, just clarity</p>
                                            </div>
                                            <div class="welcome-feature-card glass-panel p-6 rounded-2xl space-y-3 transition-all duration-300 hover:shadow-2xl group">
                                                <div class="w-14 h-14 bg-[#06b6d4]/20 rounded-xl flex items-center justify-center mx-auto transition-transform duration-300 group-hover:scale-110 group-hover:bg-[#06b6d4]/30">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-[#06b6d4]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                                                    </svg>
                                                </div>
                                                <h3 class="text-white font-bold text-lg header-title">Economical</h3>
                                                <p class="text-base text-gray-400 leading-relaxed">Optimized for enterprise-grade performance & efficiency</p>
                                            </div>
                                            <div class="welcome-feature-card glass-panel p-6 rounded-2xl space-y-3 transition-all duration-300 hover:shadow-2xl group">
                                                <div class="w-14 h-14 bg-[#f87171]/20 rounded-xl flex items-center justify-center mx-auto transition-transform duration-300 group-hover:scale-110 group-hover:bg-[#f87171]/30">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-[#f87171]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                                    </svg>
                                                </div>
                                                <h3 class="text-white font-bold text-lg header-title">Sovereignty</h3>
                                                <p class="text-base text-gray-400 leading-relaxed">Your data, your rules, your infrastructure choice - for Planning and Execution</p>
                                            </div>
                                        </div>

                                        <!-- What's New Section - Timeline Design -->
                                        <div class="mt-16 pt-12 border-t border-white/10 text-left max-w-4xl mx-auto">
                                            <div class="text-center mb-10">
                                                <h4 class="text-3xl font-bold text-white header-title mb-2">What's New</h4>
                                                <p class="text-gray-400">Recent features and improvements</p>
                                            </div>
                                            <div class="grid md:grid-cols-2 gap-x-12 gap-y-6 relative">
                                                <!-- Timeline connector line for desktop -->
                                                <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-px bg-white/10"></div>
                                                
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">22-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Profile System - Modular Configuration & Temporary Overrides</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">21-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">RAG Templates - Modular Plugin System</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">19-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Modern UI Design</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">15-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Flowise Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">14-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Airflow Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">11-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Self-Improving AI (RAG)</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">06-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">UI Real-Time Monitoring</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">31-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Configurable Context Management</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">24-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Turn Replay & Reload Plan</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">24-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Stop Button Feature</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">23-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Multi-Tool Phase Handling</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">11-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Friendly.AI Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">10-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Collateral Report Rendering</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">19-Sep-2025</p>
                                                            <p class="text-base text-white font-medium">Microsoft Azure Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">18-Sep-2025</p>
                                                            <p class="text-base text-white font-medium">REST Interface Configuration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">12-Sep-2025</p>
                                                            <p class="text-base text-white font-medium">Formatting Upgrade</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">05-Sep-2025</p>
                                                            <p class="text-base text-white font-medium">Conversation Mode (TTS)</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- LLM Leaderboard Link -->
                                        <div class="mt-12 pt-10 border-t border-white/10 max-w-3xl mx-auto">
                                            <div class="glass-panel p-6 rounded-2xl flex items-center justify-center gap-4 text-base hover:border-teradata-orange/50 transition-all duration-300 border border-white/10">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-facc15" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                                </svg>
                                                <span class="text-gray-300">View the latest LLM benchmarks:</span>
                                                <a href="https://gorilla.cs.berkeley.edu/leaderboard.html" target="_blank" class="text-teradata-orange hover:text-teradata-orange-dark font-semibold underline transition-colors">
                                                    Gorilla Leaderboard 
                                                </a>
                                            </div>
                                        </div>

                                        <!-- Disabled Capabilities (dynamically populated) -->
                                        <div id="welcome-disabled-capabilities" class="mt-8 hidden"></div>
                                    </div>
                                </div>
                                
                                <div id="chat-log" class="max-w-4xl mx-auto space-y-8">
                                    <!-- Chat messages will be added here -->
                                </div>
                            </main>

                            <footer id="chat-footer" class="p-4">
                                <div class="max-w-4xl mx-auto relative">
                                    <div id="profile-tag-selector" class="absolute bottom-full mb-2 w-full hidden"></div>
                                    <div id="rag-suggestions-container" class="absolute bottom-full mb-2 w-full hidden"></div>
                                    <div id="active-profile-tag" class="hidden"></div>
                                    <form id="chat-form" class="flex items-center gap-3 glass-panel rounded-xl p-2">
                                        <input type="text" id="user-input" placeholder="Ask about databases, tables, users..."
                                            class="flex-1 p-3 bg-transparent border-none rounded-lg focus:outline-none text-white placeholder-gray-400"
                                            autocomplete="off" disabled />
                                        <!-- Voice Input Button -->
                                        <button type="button" id="voice-input-button"
                                            class="p-3 bg-gray-600 rounded-lg hover:bg-gray-500 disabled:bg-gray-700 flex items-center justify-center w-12 h-12 transition-all duration-200 transform hover:scale-110 hidden"
                                            title="Voice Conversation (Hold Ctrl)">
                                            <svg id="mic-icon" class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M12 14a3 3 0 003-3V5a3 3 0 00-6 0v6a3 3 0 003 3z" />
                                                <path d="M12 16.5a4.5 4.5 0 01-4.5-4.5V7a1 1 0 012 0v5a2.5 2.5 0 005 0V7a1 1 0 012 0v5a4.5 4.5 0 01-4.5 4.5z" />
                                                <path d="M12 21a1 1 0 01-1-1v-2.06a7 7 0 01-5.9-6.84 1 1 0 012 0A5 5 0 0012 16a5 5 0 005-5.06 1 1 0 012 0 7 7 0 01-5.9 6.84V20a1 1 0 01-1 1z" />
                                            </svg>
                                        </button>
                                        <!-- Key Observations Toggle Button -->
                                        <button type="button" id="key-observations-toggle-button" class="p-3 bg-gray-600 rounded-lg hover:bg-gray-500 disabled:bg-gray-700 flex items-center justify-center w-12 h-12 transition-all duration-200 transform hover:scale-110 hidden" title="Key Observations - Autoplay Off">
                                            <!-- Icons for different states -->
                                            <svg id="observations-autoplay-off-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                                                <path fill-rule="evenodd" d="M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 5.352 0 9.75-3.62 9.75-8.125s-4.398-8.125-9.75-8.125S2.25 6.22 2.25 10.725c0 2.21.849 4.234 2.27 5.769a.75.75 0 0 1 .104.515v.23a.75.75 0 0 0 .45.694ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z" clip-rule="evenodd" />
                                                <path d="M12.982 4.555A.75.75 0 0 0 12 5.25v.162A8.25 8.25 0 0 1 20.25 13.5c0 2.25-.89 4.31-2.344 5.842a.75.75 0 0 0 .938 1.165A9.753 9.753 0 0 0 21.75 13.5c0-5.11-4.14-9.25-9.25-9.25a.75.75 0 0 0-.518.305Z" />
                                            </svg>
                                            <svg id="observations-autoplay-on-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white hidden" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M12.982 4.555A.75.75 0 0 0 12 5.25v.162A8.25 8.25 0 0 1 20.25 13.5c0 2.25-.89 4.31-2.344 5.842a.75.75 0 0 0 .938 1.165A9.753 9.753 0 0 0 21.75 13.5c0-5.11-4.14-9.25-9.25-9.25a.75.75 0 0 0-.518.305Z" />
                                                <path fill-rule="evenodd" d="M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 5.352 0 9.75-3.62 9.75-8.125s-4.398-8.125-9.75-8.125S2.25 6.22 2.25 10.725c0 2.21.849 4.234 2.27 5.769a.75.75 0 0 1 .104.515v.23a.75.75 0 0 0 .45.694ZM9.402 9.242a.75.75 0 0 1 1.054-.168l3.75 2.25a.75.75 0 0 1 0 1.352l-3.75 2.25a.75.75 0 0 1-1.054-1.184L12.333 12 9.402 10.258a.75.75 0 0 1-.168-1.016Z" clip-rule="evenodd" />
                                            </svg>
                                            <svg id="observations-off-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white hidden" viewBox="0 0 24 24" fill="currentColor">
                                                <path fill-rule="evenodd" d="M3.553 4.453a.75.75 0 0 0-1.06 1.06l16.5 16.5a.75.75 0 0 0 1.06-1.06l-2.03-2.03A9.732 9.732 0 0 0 21.75 13.5c0-5.11-4.14-9.25-9.25-9.25a9.68 9.68 0 0 0-3.32.556L7.203 2.78a.75.75 0 0 0-1.06-1.06l-2.59 2.59Zm2.83 2.83 2.473 2.473A8.223 8.223 0 0 1 12 5.412a8.25 8.25 0 0 1 8.25 8.25c0 .64-.074 1.264-.214 1.86l2.311 2.311A9.73 9.73 0 0 0 20.25 13.5a9.75 9.75 0 0 0-13.867-8.217Z" clip-rule="evenodd" />
                                                <path d="M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 3.425 0 6.446-1.72 8.16-4.323l-1.68-1.68A8.253 8.253 0 0 1 12 19.088a8.138 8.138 0 0 1-4.145-1.13L4.82 21.436a.75.75 0 0 1-.015.208Z" />
                                            </svg>
                                        </button>
                                        <!-- Submit Button -->
                                        <button type="submit" id="submit-button"
                                            class="p-3 bg-[#F15F22] rounded-lg hover:bg-[#D9501A] disabled:bg-gray-600 flex items-center justify-center w-12 h-12 transition-all duration-200 transform hover:scale-110"
                                            disabled>
                                            <!-- Send Icon and Loading Spinner -->
                                            <svg id="send-icon" class="w-6 h-6 text-white flipped" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                                            <svg id="loading-spinner" class="w-6 h-6 text-white animate-spin hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                        </button>
                                    </form>
                                    <div id="input-hint" class="input-hint">
                                        <!-- Input Hint Content -->
                                        <span><strong>Full Session Context:</strong> <span class="text-green-400 font-semibold">On</span></span>
                                        <div class="hint-icon">
                                            ?
                                            <span class="tooltip">Full session context is the default. Hold <kbd>Alt</kbd> to temporarily use 'Turn Summaries' context. Press <kbd>Shift</kbd> + <kbd>Alt</kbd> to lock 'Turn Summaries' context on.</span>
                                        </div>
                                    </div>
                                </div>
                            </footer>
                        </div>
                    </div>

                    <aside id="status-window" class="collapsed w-1/3 max-w-md h-full flex flex-col glass-panel rounded-l-2xl shadow-2xl border-l border-white/10" data-requires-config="true">
                        <header class="p-4 border-b border-white/10 flex flex-col justify-center items-center relative">
                            <div class="flex justify-center items-center w-full relative">
                                <h2 id="status-title" class="header-title text-lg font-bold text-white">Live Status</h2>
                                
                                <div id="status-action-buttons" class="absolute right-0 flex items-center gap-x-1">
                                    <!-- Button 3: Replay Planned Query (Dummy) -->
                                    <button id="header-replay-planned-button" title="Replay Planned Query (Not Implemented)" class="replay-action-button p-2 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10 hidden">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </button>
                                    <!-- Button 4: Replay Optimized Query (Dummy) -->
                                    <button id="header-replay-optimized-button" title="Replay Optimized Query (Not Implemented)" class="replay-action-button p-2 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10 hidden">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </button>

                                    
                                    <!-- Stop Button (Moved from absolute to flow) -->
                                    <button id="stop-execution-button" title="Stop Current Execution" class="p-2 text-red-400 hover:text-red-300 transition-colors rounded-md hover:bg-red-500/20 hidden">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div id="task-id-display" class="text-xs text-gray-400 mt-1 flex items-center justify-center gap-x-2 h-4 hidden">
                                <span id="task-id-value" class="font-semibold text-white"></span>
                                <button id="copy-task-id-button" title="Copy Task ID" class="p-1 text-gray-400 hover:text-white transition-colors rounded-md hover:bg-white/10">
                                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                </button>
                            </div>
                            <div id="status-prompt-name" class="text-xs text-gray-400 mt-1 flex items-center justify-center gap-x-2 h-4">
                                <span id="prompt-name-display">No Model/Prompt Loaded</span>
                                <span id="thinking-indicator" class="hidden items-center gap-x-1 text-yellow-400">
                                    <!-- Thinking Indicator SVG -->
                                    <svg class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                    <span>LLM Thinking...</span>
                                </span>
                            </div>
                            <div id="token-usage-display" class="text-xs text-gray-400 mt-2 w-full">
                                <!-- Token Usage Display Content -->
                                <div id="token-normal-display">
                                    <div class="flex justify-around items-center space-x-2">
                                        <div class="text-center">
                                            <span class="font-semibold text-gray-300">Last Statement</span>
                                            <div class="flex gap-x-2 justify-center">
                                                <span title="Input Tokens">In: <strong id="statement-input-tokens" class="text-white">0</strong></span>
                                                <span title="Output Tokens">Out: <strong id="statement-output-tokens" class="text-white">0</strong></span>
                                            </div>
                                        </div>
                                        <div class="border-l border-white/20 h-6"></div>
                                        <div class="text-center">
                                            <span class="font-semibold text-gray-300">Session Total</span>
                                            <div class="flex gap-x-2 justify-center">
                                                <span title="Total Input Tokens">In: <strong id="total-input-tokens" class="text-white">0</strong></span>
                                                <span title="Total Output Tokens">Out: <strong id="total-output-tokens" class="text-white">0</strong></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="token-aws-message" class="text-center hidden">Token usage not available for Amazon Bedrock</div>
                            </div>
                        </header>
                        <div id="status-window-content" class="flex-1 p-4 overflow-y-auto space-y-4">
                            <p class="text-gray-400">Waiting for a new request...</p>
                        </div>
                    </aside>
                </div>
            </div>

            <!-- VIEW X: Executions Dashboard - Three-Tier World-Class Design -->
            <div id="executions-view" class="app-view flex flex-col w-full h-full" style="background-color: var(--bg-primary);">
                <div class="w-full h-full flex flex-col overflow-hidden">
                    
                    <!-- TIER 1: Executive Command Center -->
                    <div id="exec-command-center" class="border-b border-white/10 p-6" style="background: linear-gradient(to bottom right, var(--bg-secondary), var(--bg-primary));">
                        <div class="max-w-7xl mx-auto">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h1 class="text-3xl font-bold text-white">Execution Intelligence</h1>
                                    <p class="text-gray-400 mt-1">Real-time analytics and strategic insights</p>
                                </div>
                                <button id="refresh-dashboard-btn" class="px-4 py-2 bg-teradata-orange hover:bg-orange-600 text-white rounded-lg transition-colors flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                            
                            <!-- Metrics Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                                <!-- Total Sessions Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(241, 95, 34, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-400 text-sm font-medium">Total Sessions</p>
                                            <p id="metric-total-sessions" class="text-3xl font-bold text-white mt-1">0</p>
                                        </div>
                                        <div class="w-12 h-12 bg-teradata-orange/20 rounded-lg flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-teradata-orange" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Total Tokens Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(251, 146, 60, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-400 text-sm font-medium">Total Tokens</p>
                                            <p id="metric-total-tokens" class="text-3xl font-bold text-white mt-1">0</p>
                                            <p class="text-xs text-gray-500 mt-1">
                                                <span id="metric-input-tokens">0</span> in / <span id="metric-output-tokens">0</span> out
                                            </p>
                                        </div>
                                        <div class="w-12 h-12 bg-orange-400/20 rounded-lg flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Success Rate Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(34, 197, 94, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-400 text-sm font-medium">Success Rate</p>
                                            <p id="metric-success-rate" class="text-3xl font-bold text-green-400 mt-1">0%</p>
                                        </div>
                                        <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Estimated Cost Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(234, 179, 8, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-400 text-sm font-medium">Est. Cost</p>
                                            <p id="metric-estimated-cost" class="text-3xl font-bold text-yellow-400 mt-1">$0.00</p>
                                        </div>
                                        <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Execution Velocity Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(249, 115, 22, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <p class="text-gray-400 text-sm font-medium">Velocity (24h)</p>
                                            <canvas id="velocity-sparkline" class="w-full h-8 mt-2"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Model Distribution, Expensive Sessions & Questions -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mt-4">
                                <!-- Model Distribution -->
                                <div class="rounded-xl p-4 border" style="background-color: var(--card-bg); border-color: var(--border-primary);">
                                    <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-teradata-orange" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                        </svg>
                                        Model Distribution
                                    </h3>
                                    <div id="model-distribution-list" class="space-y-2">
                                        <p class="text-gray-400 text-sm">No data available</p>
                                    </div>
                                </div>
                                
                                <!-- Most Token-Intensive Sessions -->
                                <div class="rounded-xl p-4 border" style="background-color: var(--card-bg); border-color: var(--border-primary);">
                                    <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                        Most Token-Intensive Sessions
                                    </h3>
                                    <div id="top-expensive-queries-list" class="space-y-2">
                                        <p class="text-gray-400 text-sm">No session data available</p>
                                    </div>
                                </div>
                                
                                <!-- Most Token-Intensive Questions -->
                                <div class="rounded-xl p-4 border" style="background-color: var(--card-bg); border-color: var(--border-primary);">
                                    <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        Most Token-Intensive Questions
                                    </h3>
                                    <div id="top-expensive-questions-list" class="space-y-2">
                                        <p class="text-gray-400 text-sm">No question data available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TIER 2: Session Gallery -->
                    <div id="session-gallery" class="flex-1 p-6 overflow-y-auto" style="background-color: var(--bg-primary);">
                        <div class="max-w-7xl mx-auto">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-white">Session Gallery</h2>
                                
                                <!-- Filter & Sort Controls -->
                                <div class="flex items-center gap-3">
                                    <div class="relative">
                                        <input 
                                            id="session-search" 
                                            type="text" 
                                            placeholder="Search sessions or questions..." 
                                            class="px-4 py-2 pr-10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-teradata-orange transition-colors"
                                            style="background-color: var(--input-bg); border: 1px solid var(--border-primary);"
                                        />
                                        <button 
                                            id="clear-search-btn" 
                                            class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors hidden"
                                            title="Clear search"
                                        >
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    
                                    <!-- View All Sessions Toggle (Developer/Admin Only) -->
                                    <div id="view-all-sessions-container" class="hidden">
                                        <label class="flex items-center gap-3 px-4 py-2 bg-white/5 border border-white/10 rounded-lg cursor-pointer hover:bg-white/10 transition-all group">
                                            <input type="checkbox" id="view-all-sessions-toggle">
                                            <div class="flex items-center gap-2">
                                                <svg class="w-4 h-4 text-gray-400 group-hover:text-teradata-orange transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                                <span class="text-sm text-white font-medium">View All Users' Sessions</span>
                                            </div>
                                        </label>
                                    </div>
                                    
                                    <select id="session-filter-status" class="px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-teradata-orange transition-colors">
                                        <option value="all">All Status</option>
                                        <option value="success">Success</option>
                                        <option value="partial">Partial</option>
                                        <option value="failed">Failed</option>
                                    </select>
                                    <select id="session-sort" class="px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-teradata-orange transition-colors">
                                        <option value="recent">Most Recent</option>
                                        <option value="oldest">Oldest First</option>
                                        <option value="tokens">Most Tokens</option>
                                        <option value="turns">Most Turns</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Session Cards Grid -->
                            <div id="session-cards-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- Session cards will be dynamically inserted here -->
                                <div class="col-span-full text-center py-12">
                                    <p class="text-gray-400">Loading sessions...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TIER 3: Deep Dive Inspector (Initially Hidden) -->
                    <div id="deep-dive-inspector" class="hidden fixed inset-0 backdrop-blur-sm z-50 overflow-y-auto" style="background-color: var(--modal-overlay);">
                        <div class="min-h-screen flex items-start justify-center p-6">
                            <div class="rounded-2xl border max-w-6xl w-full my-8 shadow-2xl" style="background: linear-gradient(to bottom right, var(--bg-secondary), var(--bg-primary)); border-color: var(--border-primary);">
                                <!-- Inspector Header -->
                                <div class="border-b border-white/10 p-6 flex items-center justify-between">
                                    <div>
                                        <h2 id="inspector-session-name" class="text-2xl font-bold text-white">Session Details</h2>
                                        <p id="inspector-session-meta" class="text-gray-400 mt-1">Loading...</p>
                                    </div>
                                    <button id="close-inspector-btn" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <!-- Inspector Content -->
                                <div class="p-6 space-y-6">
                                    <!-- Session Stats -->
                                    <div class="grid grid-cols-4 gap-4">
                                        <div class="rounded-lg p-4" style="background-color: var(--card-bg);">
                                            <p class="text-gray-400 text-sm">Total Turns</p>
                                            <p id="inspector-turn-count" class="text-2xl font-bold text-white mt-1">0</p>
                                        </div>
                                        <div class="rounded-lg p-4" style="background-color: var(--card-bg);">
                                            <p class="text-gray-400 text-sm">Total Tokens</p>
                                            <p id="inspector-total-tokens" class="text-2xl font-bold text-white mt-1">0</p>
                                        </div>
                                        <div class="rounded-lg p-4" style="background-color: var(--card-bg);">
                                            <p class="text-gray-400 text-sm">Model</p>
                                            <p id="inspector-model" class="text-lg font-semibold text-white mt-1">-</p>
                                        </div>
                                        <div class="rounded-lg p-4" style="background-color: var(--card-bg);">
                                            <p class="text-gray-400 text-sm">RAG Cases</p>
                                            <p id="inspector-rag-count" class="text-2xl font-bold text-green-400 mt-1">0</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Timeline -->
                                    <div>
                                        <h3 class="text-xl font-bold text-white mb-4">Execution Timeline</h3>
                                        <div id="inspector-timeline" class="space-y-4">
                                            <p class="text-gray-400">Loading timeline...</p>
                                        </div>
                                    </div>
                                    
                                    <!-- RAG Cases -->
                                    <div id="inspector-rag-section" class="hidden">
                                        <h3 class="text-xl font-bold text-white mb-4">RAG Efficiency Cases</h3>
                                        <div id="inspector-rag-cases" class="space-y-3">
                                            <!-- RAG cases will be inserted here -->
                                        </div>
                                    </div>
                                    
                                    <!-- Export Options -->
                                    <div class="border-t border-white/10 pt-6 flex gap-3">
                                        <button id="export-json-btn" class="px-4 py-2 bg-teradata-orange hover:bg-orange-600 text-white rounded-lg transition-colors">
                                            Export as JSON
                                        </button>
                                        <button id="export-report-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                            Generate Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <!-- VIEW 2: RAG Maintenance (New, placeholder view) -->
            <!-- VIEW 2A: RAG Marketplace (New, placeholder view) -->
            <div id="rag-marketplace-view" class="app-view w-full h-full p-8 flex items-center justify-center">
                <div class="max-w-4xl mx-auto text-center space-y-8">
                    <!-- Icon -->
                    <div class="flex justify-center">
                        <div class="w-24 h-24 bg-[#F15F22]/20 backdrop-blur-sm border border-[#F15F22]/30 rounded-2xl flex items-center justify-center shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-14 w-14 text-[#F15F22]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Heading -->
                    <div class="space-y-4">
                        <h1 class="text-4xl font-bold text-white">Community Knowledge Marketplace</h1>
                        <p class="text-2xl font-semibold text-[#F15F22]">Coming Soon</p>
                    </div>
                    
                    <!-- Value Proposition -->
                    <div class="space-y-6 text-left bg-white/5 rounded-2xl p-8 backdrop-blur-sm border border-white/10">
                        <h2 class="text-xl font-bold text-white text-center">The Power of Collective Intelligence</h2>
                        
                        <div class="space-y-4">
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-white mb-1">Share & Discover Execution Strategies</h3>
                                    <p class="text-gray-400">Access community-curated knowledge bases of proven planner executions, optimized for specific MCP servers and use cases.</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-white mb-1">Supercharge Efficiency</h3>
                                    <p class="text-gray-400">Dramatically reduce token costs and improve execution speed by learning from battle-tested strategies that already work.</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-white mb-1">Enable On-Prem Intelligence</h3>
                                    <p class="text-gray-400">Augment smaller, local models with community knowledge, achieving enterprise-grade results while maintaining data sovereignty.</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 w-8 h-8 bg-orange-500/20 rounded-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-white mb-1">Continuous Learning Loop</h3>
                                    <p class="text-gray-400">The planner evolves with every shared execution, creating a self-improving ecosystem that benefits everyone.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CTA -->
                    <div class="pt-4">
                        <p class="text-gray-400 text-lg">
                            Building the future of collaborative AI intelligence. Stay tuned!
                        </p>
                    </div>
                </div>
            </div>

            <div id="rag-maintenance-view" class="app-view w-full h-full p-8 overflow-y-auto">
                <div class="max-w-7xl mx-auto">
                    <div class="mb-6">
                        <h1 class="text-3xl font-bold text-white header-title">RAG Impact Dashboard</h1>
                    </div>

                    <!-- RAG Impact KPI Cards -->
                    <div class="grid gap-6 md:grid-cols-4 mb-8">
                        <!-- Self-Healing Events Card -->
                        <div class="glass-panel rounded-xl p-6 border-l-4 border-green-500" 
                             title="Champion strategies available for RAG retrieval. These are the most efficient, proven solutions that RAG can inject into new tasks to accelerate execution and prevent errors.">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-400">Champion Strategies</h3>
                                        <p class="text-xs text-gray-500">Available for RAG</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div>
                                    <p class="text-4xl font-bold text-white" id="rag-kpi-healing-count">--</p>
                                    <p class="text-xs text-green-400 mt-1 flex items-center gap-1" id="rag-kpi-healing-trend">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                        </svg>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- RAG Activation Rate Card -->
                        <div class="glass-panel rounded-xl p-6 border-l-4 border-emerald-500"
                             title="Percentage of agent tasks that received RAG assistance. Shows how often champion strategies were retrieved and injected into LLM prompts to guide execution.">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-emerald-500/20 rounded-lg flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-400">RAG Activation Rate</h3>
                                        <p class="text-xs text-gray-500">Tasks Enhanced</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div class="w-full">
                                    <p class="text-4xl font-bold text-white mb-2" id="rag-kpi-activation-rate">--%</p>
                                    <div class="space-y-1">
                                        <div class="flex justify-between text-xs text-gray-400">
                                            <span>RAG-Enhanced:</span>
                                            <span id="rag-kpi-enhanced-count" class="text-emerald-400 font-semibold">--</span>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-400">
                                            <span>Total Tasks:</span>
                                            <span id="rag-kpi-total-tasks" class="font-semibold">--</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Savings Card -->
                        <div class="glass-panel rounded-xl p-6 border-l-4 border-yellow-500"
                             title="Estimated cost savings when RAG provides champion strategies upfront vs trial-and-error exploration. Champion strategies reduce output tokens by ~50% by avoiding failed attempts and corrections.">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-400">Potential Savings</h3>
                                        <p class="text-xs text-gray-500">Via Champion Cases</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div>
                                    <p class="text-4xl font-bold text-white" id="rag-kpi-cost-savings">$--</p>
                                    <p class="text-xs text-gray-400 mt-1" id="rag-kpi-tokens-saved">-- tokens saved</p>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Improvement Card -->
                        <div class="glass-panel rounded-xl p-6 border-l-4 border-blue-500"
                             title="Estimated speed improvement when RAG retrieves champion strategies. By providing proven solutions upfront, RAG eliminates exploration and correction cycles, typically achieving 60-70% faster execution.">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-400">Speed Boost</h3>
                                        <p class="text-xs text-gray-500">With Champion Cases</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div class="w-full">
                                    <p class="text-4xl font-bold text-white mb-2" id="rag-kpi-speed-improvement">--%</p>
                                    <div class="space-y-1">
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-gray-400">With RAG:</span>
                                            <span class="text-green-400 font-medium" id="rag-kpi-speed-with">--s</span>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-gray-400">Without RAG:</span>
                                            <span class="text-gray-400" id="rag-kpi-speed-without">--s</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Separator between Dashboard and Collections -->
                    <div class="my-8 border-t border-white/10"></div>

                    <!-- Collections Section -->
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-white">Local Collections</h2>
                            <p class="text-sm text-gray-400 mt-1">Manage your RAG knowledge base collections</p>
                        </div>
                        <button id="add-rag-collection-btn" type="button" class="px-4 py-2 rounded-md bg-[#F15F22] hover:bg-[#D9501A] text-white font-medium text-sm flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Add Collection
                        </button>
                    </div>
                    <div id="rag-maintenance-collections-container" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                        <!-- Dynamic ChromaDB collection cards will be injected here -->
                        <div class="col-span-full text-gray-400 text-sm" id="rag-maintenance-empty-hint">Loading collections...</div>
                    </div>

                    <!-- Separator between Collections and Templates -->
                    <div class="my-8 border-t border-white/10"></div>

                    <!-- Templates Section -->
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h2 class="text-2xl font-bold text-white">RAG Templates</h2>
                                <p class="text-sm text-gray-400 mt-1">Populate collections using predefined templates</p>
                            </div>
                        </div>
                        
                        <!-- Template Cards (dynamically loaded) -->
                        <div id="rag-templates-container" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                            <!-- Templates will be dynamically loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 2B: RAG Collection Inspection -->
            <div id="rag-collection-inspect-view" class="app-view w-full h-full p-8">
                <div class="max-w-7xl mx-auto flex flex-col h-full">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-4">
                            <button id="rag-collection-inspect-back" type="button" class="px-3 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-sm text-gray-200">Back</button>
                            <h1 id="rag-collection-inspect-title" class="text-2xl font-bold text-white header-title">Inspect Collection</h1>
                        </div>
                        <div class="flex items-center gap-3">
                            <input id="rag-collection-search-input" type="text" placeholder="Search (min 3 chars)..." class="w-64 p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-sm" />
                            <button id="rag-collection-refresh" type="button" class="px-3 py-2 rounded-md bg-[#F15F22] hover:bg-[#D9501A] text-sm text-white">Refresh Sample</button>
                        </div>
                    </div>
                    <div id="rag-collection-table-wrapper" class="flex-1 min-h-0 flex flex-col glass-panel rounded-xl p-4 overflow-hidden">
                        <div id="rag-collection-loading" class="text-gray-400 text-sm mb-2">Loading rows...</div>
                        <div class="overflow-auto flex-1">
                            <table class="min-w-full text-sm">
                                <thead class="sticky top-0 bg-gray-800">
                                    <tr>
                                        <th class="px-2 py-1 text-left text-gray-300 font-semibold">ID</th>
                                        <th class="px-2 py-1 text-left text-gray-300 font-semibold">User Query</th>
                                        <th class="px-2 py-1 text-left text-gray-300 font-semibold">Strategy</th>
                                        <th class="px-2 py-1 text-left text-gray-300 font-semibold">Efficient</th>
                                        <th class="px-2 py-1 text-left text-gray-300 font-semibold">Feedback</th>
                                        <th class="px-2 py-1 text-left text-gray-300 font-semibold">Output Tokens</th>
                                        <th class="px-2 py-1 text-left text-gray-300 font-semibold">Timestamp</th>
                                    </tr>
                                </thead>
                                <tbody id="rag-collection-table-body"></tbody>
                            </table>
                        </div>
                        <div id="rag-collection-footer" class="mt-2 text-xs text-gray-500"></div>
                        <!-- Visible separator shown once a case is selected -->
                        <div id="rag-selected-case-separator" class="hidden my-6 border-t border-white/10"></div>
                        <div id="rag-selected-case-details" class="mt-4 hidden">
                            <h2 class="text-lg font-bold text-white mb-2">Selected Case Details</h2>
                            <div id="rag-selected-case-metadata" class="text-xs text-gray-400 mb-3"></div>
                            <div id="rag-selected-case-plan" class="mb-4"></div>
                            <div id="rag-selected-case-trace" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- --- MODIFICATION START: Add Credentials View --- -->
            <!-- MODIFICATION: No longer the default active view -->
            <div id="credentials-view" class="app-view w-full h-full flex flex-col p-6">
                <div class="w-full max-w-7xl mx-auto flex flex-col h-full">
                    <!-- Page Header -->
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-white">Configuration</h2>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="flex gap-2 border-b border-white/10 mb-6">
                        <button class="config-tab active px-6 py-3 text-sm font-medium transition-all border-b-2 border-[#F15F22] text-white" data-tab="mcp-servers-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9V3m-3.516 6.636a9 9 0 015.032 0" />
                                </svg>
                                MCP Servers
                            </div>
                        </button>
                        <button class="config-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="llm-providers-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                </svg>
                                LLM Providers
                            </div>
                        </button>
                        <button class="config-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="profiles-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                Profiles
                            </div>
                        </button>
                        <button class="config-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="advanced-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                </svg>
                                Advanced
                            </div>
                        </button>
                    </div>

                    <!-- Tab Content Container -->
                    <div class="flex-1 overflow-y-auto">
                        <!-- Tab 1: MCP Servers -->
                        <div id="mcp-servers-tab" class="config-tab-content active">
                            <div class="space-y-6">
                                            <!-- Section 1: MCP Servers -->
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Configure MCP Servers</h3>
                                            <p class="text-sm text-gray-400 mt-1">Model-Context-Protocol servers provide access to your data sources</p>
                                        </div>
                                        <button type="button" id="add-mcp-server-btn" class="px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                            + Add Server
                                        </button>
                                    </div>
                                    <div id="mcp-servers-container" class="space-y-4">
                                        <!-- MCP server cards will be dynamically added here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: LLM Providers -->
                        <div id="llm-providers-tab" class="config-tab-content hidden">
                            <div class="space-y-6">
                                <!-- Section 2: LLM Providers -->
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Configure LLM Providers</h3>
                                            <p class="text-sm text-gray-400 mt-1">Create and manage LLM configurations with different models and credentials</p>
                                        </div>
                                        <button type="button" id="add-llm-config-btn" class="px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                            + Add Configuration
                                        </button>
                                    </div>
                                    <div id="llm-providers-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <!-- LLM configuration cards will be dynamically added here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Profiles -->
                        <div id="profiles-tab" class="config-tab-content hidden">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Configure Profiles</h3>
                                            <p class="text-sm text-gray-400 mt-1">Create and manage profiles for different configurations</p>
                                        </div>
                                                        <div class="flex items-center gap-2">
                                                            <button type="button" id="test-all-profiles-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                                                Test All Profiles
                                                            </button>
                                                            <button type="button" id="add-profile-btn" class="px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                                + Add Profile
                                                            </button>
                                                        </div>                                    </div>
                                    <div id="profiles-container" class="space-y-4">
                                        <!-- Profile cards will be dynamically added here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 4: Advanced Settings -->
                        <div id="advanced-tab" class="config-tab-content hidden">
                            <div class="space-y-6">
                                <!-- Section 3: Optional Services -->
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="mb-6">
                                        <h3 class="text-xl font-bold text-white">Advanced Settings</h3>
                                        <p class="text-sm text-gray-400 mt-1">Configure optional features and services</p>
                                    </div>
                                    <div class="space-y-6">
                                        <div>
                                            <label for="charting-intensity" class="block text-sm font-medium text-gray-300 mb-2">Charting Intensity</label>
                                            <select id="charting-intensity" name="charting_intensity" class="w-full max-w-md p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none">
                                                <option value="none" selected>No Charting</option>
                                                <option value="medium">Medium Charting</option>
                                                <option value="heavy">Heavy Charting</option>
                                            </select>
                                        </div>
                                        <div class="pt-4 border-t border-white/10">
                                            <details>
                                                <summary class="text-sm font-medium text-gray-300 cursor-pointer hover:text-white mb-2">Configure Google TTS</summary>
                                                <div class="mt-4">
                                                    <label for="tts-credentials-json" class="block text-sm font-medium text-gray-400 mb-2">Google TTS Credentials JSON (Optional)</label>
                                                    <textarea id="tts-credentials-json" name="tts_credentials_json" rows="4" class="w-full max-w-2xl p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-sm font-mono" placeholder="Paste credentials.json content here. Leave blank to use server environment variable."></textarea>
                                                </div>
                                            </details>
                                        </div>
                                        <div class="pt-4 border-t border-white/10">
                                            <label for="tda-user-uuid" class="block text-sm font-medium text-gray-300 mb-2">REST API User ID</label>
                                            <div class="flex items-center gap-2 max-w-2xl">
                                                <input type="text" id="tda-user-uuid" name="tda_user_uuid" class="flex-1 p-2 bg-gray-800 border border-gray-600 rounded-md text-gray-400" readonly>
                                                <button type="button" id="copy-uuid-button" title="Copy UUID" class="p-2 bg-gray-600 hover:bg-gray-500 rounded-md transition-colors">
                                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Button - Always Visible -->
                    <div class="glass-panel rounded-xl p-6 mt-6 flex-shrink-0">
                        <button id="reconnect-and-load-btn" type="button" disabled class="w-full px-6 py-3 rounded-md bg-gray-600 transition-colors font-medium flex items-center justify-center text-white disabled:opacity-50 disabled:cursor-not-allowed enabled:bg-gray-700 enabled:hover:bg-gray-600">
                            <!-- Cogwheel Icon (spins during connection) -->
                            <svg id="reconnect-loading-spinner" class="w-5 h-5 mr-2 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <span id="reconnect-button-text">Save & Connect</span>
                        </button>
                        <div id="reconnect-status" class="text-sm min-h-[1.25rem] mt-4 text-center"></div>
                    </div>
                </div>
            </div>
            <!-- --- MODIFICATION END: Credentials View --- -->

            <!-- VIEW: Administration -->
            <div id="admin-view" class="app-view w-full h-full flex flex-col p-6">
                <div class="w-full max-w-7xl mx-auto flex flex-col h-full">
                    <!-- Page Header -->
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-white">Administration</h2>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="flex gap-2 border-b border-white/10 mb-6">
                        <button class="admin-tab active px-6 py-3 text-sm font-medium transition-all border-b-2 border-[#F15F22] text-white" data-tab="user-management-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                </svg>
                                User Management
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="pane-config-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 16a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-3zM14 16a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1h-4a1 1 0 01-1-1v-3z" />
                                </svg>
                                Pane Configuration
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="feature-config-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                                Feature Configuration
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="app-config-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                Application Configuration
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="expert-settings-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                                </svg>
                                Expert Settings
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="system-prompts-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                System Prompts
                            </div>
                        </button>
                    </div>

                    <!-- Tab Content Container -->
                    <div class="flex-1 overflow-y-auto">
                        <!-- Tab 1: User Management -->
                        <div id="user-management-tab" class="admin-tab-content active">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">User Tier Management</h3>
                                            <p class="text-sm text-gray-400 mt-1">Assign users to profile tiers (User, Developer, Admin)</p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button type="button" id="create-user-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-md transition-colors text-white font-medium text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                                                </svg>
                                                Create User
                                            </button>
                                            <button type="button" id="refresh-users-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                </svg>
                                                Refresh
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Users Table -->
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs uppercase bg-gray-700/50 text-gray-400">
                                                <tr>
                                                    <th class="px-6 py-3">Username</th>
                                                    <th class="px-6 py-3">Email</th>
                                                    <th class="px-6 py-3">Current Tier</th>
                                                    <th class="px-6 py-3">Features</th>
                                                    <th class="px-6 py-3">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="users-table-body" class="divide-y divide-gray-700">
                                                <!-- Users will be dynamically loaded here -->
                                                <tr>
                                                    <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                                                        <svg class="animate-spin h-8 w-8 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        Loading users...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Tier Statistics -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="glass-panel rounded-xl p-6">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm text-gray-400">User Tier</p>
                                                <p id="user-tier-count" class="text-3xl font-bold text-white mt-2">0</p>
                                            </div>
                                            <div class="p-3 bg-blue-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm text-gray-400">Developer Tier</p>
                                                <p id="developer-tier-count" class="text-3xl font-bold text-white mt-2">0</p>
                                            </div>
                                            <div class="p-3 bg-purple-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm text-gray-400">Admin Tier</p>
                                                <p id="admin-tier-count" class="text-3xl font-bold text-white mt-2">0</p>
                                            </div>
                                            <div class="p-3 bg-red-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Feature Configuration -->
                        <div id="feature-config-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Feature-to-Tier Configuration</h3>
                                            <p class="text-sm text-gray-400 mt-1">Configure which tier is required for each feature</p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button type="button" id="reset-features-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium text-sm">
                                                Reset to Defaults
                                            </button>
                                            <button type="button" id="save-features-btn" class="px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                Save Changes
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Feature Configuration Table -->
                                    <div class="mb-6">
                                        <div class="flex items-center gap-4 mb-4">
                                            <input type="text" id="feature-search" placeholder="Search features..." class="flex-1 max-w-md p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white">
                                            <select id="feature-filter-tier" class="p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white">
                                                <option value="">All Tiers</option>
                                                <option value="user">User Tier</option>
                                                <option value="developer">Developer Tier</option>
                                                <option value="admin">Admin Tier</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="overflow-x-auto max-h-[600px] overflow-y-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs uppercase bg-gray-700/50 text-gray-400 sticky top-0">
                                                <tr>
                                                    <th class="px-6 py-3">Feature</th>
                                                    <th class="px-6 py-3">Description</th>
                                                    <th class="px-6 py-3">Required Tier</th>
                                                    <th class="px-6 py-3">Category</th>
                                                </tr>
                                            </thead>
                                            <tbody id="features-table-body" class="divide-y divide-gray-700">
                                                <!-- Features will be dynamically loaded here -->
                                                <tr>
                                                    <td colspan="4" class="px-6 py-8 text-center text-gray-400">
                                                        <svg class="animate-spin h-8 w-8 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        Loading features...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Feature Statistics by Tier -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-sm font-medium text-gray-400 mb-3">User Tier Features</h4>
                                        <p id="user-features-count" class="text-2xl font-bold text-blue-400">0</p>
                                        <p class="text-xs text-gray-500 mt-1">Basic access features</p>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-sm font-medium text-gray-400 mb-3">Developer Tier Features</h4>
                                        <p id="developer-features-count" class="text-2xl font-bold text-purple-400">0</p>
                                        <p class="text-xs text-gray-500 mt-1">Advanced features</p>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-sm font-medium text-gray-400 mb-3">Admin Tier Features</h4>
                                        <p id="admin-features-count" class="text-2xl font-bold text-red-400">0</p>
                                        <p class="text-xs text-gray-500 mt-1">System administration</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Pane Configuration -->
                        <div id="pane-config-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Pane Visibility Configuration</h3>
                                            <p class="text-sm text-gray-400 mt-1">Configure which tiers can access which panes</p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button type="button" id="reset-panes-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium text-sm">
                                                Reset to Defaults
                                            </button>
                                            <button type="button" id="refresh-panes-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                </svg>
                                                Refresh
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Pane Configuration Table -->
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs uppercase bg-gray-700/50 text-gray-400">
                                                <tr>
                                                    <th class="px-6 py-3">Pane Name</th>
                                                    <th class="px-6 py-3">Description</th>
                                                    <th class="px-6 py-3 text-center">
                                                        <div class="flex items-center justify-center gap-2">
                                                            <span class="inline-block w-2 h-2 rounded-full bg-blue-400"></span>
                                                            User
                                                        </div>
                                                    </th>
                                                    <th class="px-6 py-3 text-center">
                                                        <div class="flex items-center justify-center gap-2">
                                                            <span class="inline-block w-2 h-2 rounded-full bg-purple-400"></span>
                                                            Developer
                                                        </div>
                                                    </th>
                                                    <th class="px-6 py-3 text-center">
                                                        <div class="flex items-center justify-center gap-2">
                                                            <span class="inline-block w-2 h-2 rounded-full bg-red-400"></span>
                                                            Admin
                                                        </div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="panes-table-body" class="divide-y divide-gray-700">
                                                <!-- Panes will be dynamically loaded here -->
                                                <tr>
                                                    <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                                                        <svg class="animate-spin h-8 w-8 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        Loading panes...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Info Panel -->
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex items-start gap-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        <div>
                                            <h4 class="text-sm font-bold text-white mb-2">About Pane Visibility</h4>
                                            <p class="text-sm text-gray-400 mb-3">Control which user tiers can see and access different panes in the application. Users will only see panes they have access to based on their assigned tier.</p>
                                            <ul class="text-sm text-gray-400 space-y-1 list-disc list-inside">
                                                <li><span class="text-blue-400 font-semibold">User Tier</span>: Basic users with limited access</li>
                                                <li><span class="text-purple-400 font-semibold">Developer Tier</span>: Advanced users with development features</li>
                                                <li><span class="text-red-400 font-semibold">Admin Tier</span>: Full system access and administration</li>
                                            </ul>
                                            <p class="text-xs text-gray-500 mt-3">Note: The Administration pane is always visible to admins only.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 4: Application Configuration -->
                        <div id="app-config-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <!-- MCP Resource Classification -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">MCP Resource Classification</h3>
                                                    <p class="text-sm text-gray-400">Configure LLM-based classification of MCP capabilities</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <!-- Classification Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-mcp-classification" name="enable_mcp_classification" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0" checked>
                                                    <div class="flex-1">
                                                        <label for="enable-mcp-classification" class="block text-sm font-semibold text-white cursor-pointer">Enable Automatic Classification</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, MCP capabilities are automatically categorized during configuration using the LLM (takes 2-10 seconds). When disabled, generic categories like "All Tools" and "All Prompts" are used for faster configuration (90-95% faster).</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="flex items-start gap-3 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                                <div>
                                                    <h4 class="text-sm font-bold text-white mb-2">About Classification</h4>
                                                    <p class="text-sm text-gray-400 mb-2">Uses an LLM to intelligently categorize MCP capabilities into user-friendly groups like "Data Quality", "Table Management", "Performance", etc.</p>
                                                    <ul class="text-sm text-gray-400 space-y-1 list-disc list-inside">
                                                        <li>Improves organization in the configuration UI</li>
                                                        <li>Makes capabilities easier to find and manage</li>
                                                        <li>Requires an active LLM connection</li>
                                                        <li>May take several seconds to complete</li>
                                                    </ul>
                                                </div>
                                            </div>

                                            <div class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg">
                                                <div>
                                                    <h4 class="text-sm font-semibold text-white mb-1">Classification Status</h4>
                                                    <p id="mcp-classification-status" class="text-sm text-gray-400">Ready to classify</p>
                                                    <p id="mcp-classification-details" class="text-xs text-gray-500 mt-1"></p>
                                                </div>
                                                <button type="button" id="run-mcp-classification-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm flex items-center gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                    </svg>
                                                    Run Classification
                                                </button>
                                            </div>

                                            <!-- Progress indicator (hidden by default) -->
                                            <div id="mcp-classification-progress" class="hidden p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                                                <div class="flex items-center gap-3">
                                                    <svg class="animate-spin h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                    </svg>
                                                    <div>
                                                        <p class="text-sm font-medium text-yellow-400">Classification in progress...</p>
                                                        <p class="text-xs text-gray-400 mt-1">This may take a few moments</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- System Feature Availability -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">System Feature Availability</h3>
                                                    <p class="text-sm text-gray-400">Control which features are available system-wide</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <!-- RAG Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-rag-system" name="enable_rag_system" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="enable-rag-system" class="block text-sm font-semibold text-white cursor-pointer">Enable RAG (Retrieval-Augmented Generation)</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, users can leverage RAG capabilities for enhanced context retrieval and knowledge base integration. Requires ChromaDB and vector embeddings.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Voice/TTS Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-voice-system" name="enable_voice_system" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="enable-voice-system" class="block text-sm font-semibold text-white cursor-pointer">Enable Voice Conversation (TTS)</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, users can configure Google TTS credentials for voice-based conversations. Users provide their own TTS API credentials in their personal settings.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Charting Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-charting-system" name="enable_charting_system" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="enable-charting-system" class="block text-sm font-semibold text-white cursor-pointer">Enable Charting & Visualization</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, users can configure charting intensity (none/medium/heavy) for data visualization. Users control their own charting preferences in personal settings.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Save Button -->
                                            <div class="pt-4 border-t border-white/10">
                                                <button type="button" id="save-app-config-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                    Save Feature Settings
                                                </button>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- RAG Configuration -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">RAG Configuration</h3>
                                                    <p class="text-sm text-gray-400">Retrieval-Augmented Generation settings</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    <div>
                                                        <p class="text-sm text-gray-300">These settings control how the RAG system retrieves and uses examples from the knowledge base. Changes affect all users when RAG is enabled.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="rag-refresh-startup" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="rag-refresh-startup" class="block text-sm font-semibold text-white cursor-pointer">Refresh Vector Store on Startup</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, rebuilds the vector store on each application restart. When disabled, uses cached embeddings. (default: enabled)</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div>
                                                <label for="rag-num-examples" class="block text-sm font-medium text-gray-300 mb-2">Number of Examples to Retrieve</label>
                                                <input type="number" id="rag-num-examples" min="1" max="10" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Total few-shot examples retrieved across all collections (default: 3)</p>
                                            </div>

                                            <div>
                                                <label for="rag-embedding-model" class="block text-sm font-medium text-gray-300 mb-2">Embedding Model</label>
                                                <select id="rag-embedding-model" class="w-full max-w-md px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                    <option value="all-MiniLM-L6-v2">all-MiniLM-L6-v2 (Fast, 384 dim)</option>
                                                    <option value="all-mpnet-base-v2">all-mpnet-base-v2 (Balanced, 768 dim)</option>
                                                    <option value="paraphrase-multilingual-MiniLM-L12-v2">paraphrase-multilingual-MiniLM-L12-v2 (Multilingual)</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">Model used for generating embeddings (requires restart to take effect)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Window Management -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 0a2 2 0 012 2v8a2 2 0 01-2 2h-2a2 2 0 01-2-2V9a2 2 0 012-2z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Window Management</h3>
                                                    <p class="text-sm text-gray-400">Default panel visibility settings (users can override in their preferences)</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    <div>
                                                        <p class="text-sm text-gray-300">These settings define the default visibility state for panels when users first load the application. Individual users can override these defaults using their personal panel toggles, and their preferences will be saved locally.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Session History Panel -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="default-session-history-expanded" name="default_session_history_expanded" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="default-session-history-expanded" class="block text-sm font-semibold text-white cursor-pointer">Session History Panel Expanded by Default</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, the left session history panel will be visible when users first load the application. Users can toggle this panel and their preference will be remembered.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Resources Panel -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="default-resources-expanded" name="default_resources_expanded" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="default-resources-expanded" class="block text-sm font-semibold text-white cursor-pointer">Resources Panel Expanded by Default</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, the right resources panel will be visible when users first load the application. Users can toggle this panel and their preference will be remembered.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Live Status Panel -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="default-status-expanded" name="default_status_expanded" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="default-status-expanded" class="block text-sm font-semibold text-white cursor-pointer">Live Status Window Expanded by Default</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, the bottom live status window will be visible when users first load the application. Users can toggle this window and their preference will be remembered.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- User Override Control -->
                                            <div class="p-4 bg-orange-500/10 border border-orange-500/30 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="allow-user-panel-override" name="allow_user_panel_override" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0" checked>
                                                    <div class="flex-1">
                                                        <label for="allow-user-panel-override" class="block text-sm font-semibold text-white cursor-pointer">Allow Users to Override Panel Settings</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, users can toggle panels and save their preferences. When disabled, the above default settings are enforced for all users and panel toggle controls are hidden.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Save Button -->
                                            <div class="pt-4 border-t border-white/10">
                                                <button type="button" id="save-window-defaults-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                    Save Window Defaults
                                                </button>
                                            </div>
                                        </div>
                                    </details>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 5: Expert Settings -->
                        <div id="expert-settings-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <!-- Warning Banner -->
                                <div class="glass-panel rounded-xl p-4 bg-red-500/10 border border-red-500/30">
                                    <div class="flex items-start gap-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                        </svg>
                                        <div>
                                            <h4 class="text-sm font-bold text-red-400 mb-1">Advanced Configuration Area</h4>
                                            <p class="text-sm text-gray-300">These settings directly affect system behavior and performance. Incorrect values may cause instability or errors. Modify only if you understand the implications.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- LLM Behavior -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">LLM Behavior</h3>
                                                    <p class="text-sm text-gray-400">Configure retry logic and API behavior</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div>
                                                <label for="llm-max-retries" class="block text-sm font-medium text-gray-300 mb-2">Max API Retries</label>
                                                <input type="number" id="llm-max-retries" min="0" max="20" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Maximum attempts for failed LLM API calls (default: 5)</p>
                                            </div>
                                            <div>
                                                <label for="llm-base-delay" class="block text-sm font-medium text-gray-300 mb-2">Retry Base Delay (seconds)</label>
                                                <input type="number" id="llm-base-delay" min="0" max="30" step="0.5" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Initial delay for exponential backoff (default: 2)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Agent Configuration -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Agent Configuration</h3>
                                                    <p class="text-sm text-gray-400">Control agent execution limits and timeouts</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div>
                                                <label for="max-execution-steps" class="block text-sm font-medium text-gray-300 mb-2">Max Execution Steps</label>
                                                <input type="number" id="max-execution-steps" min="1" max="100" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Maximum planning/execution iterations (default: 25)</p>
                                            </div>
                                            <div>
                                                <label for="tool-call-timeout" class="block text-sm font-medium text-gray-300 mb-2">Tool Call Timeout (seconds)</label>
                                                <input type="number" id="tool-call-timeout" min="5" max="600" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Timeout for individual tool executions (default: 60)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Performance & Context -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Performance & Context</h3>
                                                    <p class="text-sm text-gray-400">Data volume and context size limits</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div>
                                                <label for="context-max-rows" class="block text-sm font-medium text-gray-300 mb-2">Max Context Rows</label>
                                                <input type="number" id="context-max-rows" min="10" max="10000" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Maximum rows from tool results sent to LLM (default: 500)</p>
                                            </div>
                                            <div>
                                                <label for="context-max-chars" class="block text-sm font-medium text-gray-300 mb-2">Max Context Characters</label>
                                                <input type="number" id="context-max-chars" min="1000" max="100000" step="1000" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Maximum characters from tool results (default: 10000)</p>
                                            </div>
                                            <div>
                                                <label for="description-threshold" class="block text-sm font-medium text-gray-300 mb-2">Task Complexity Threshold</label>
                                                <input type="number" id="description-threshold" min="50" max="1000" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Character count to detect detailed tasks (default: 200)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Agent Behavior -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Agent Behavior</h3>
                                                    <p class="text-sm text-gray-400">Control agent reasoning and response patterns</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="allow-synthesis" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="allow-synthesis" class="block text-sm font-semibold text-white cursor-pointer">Allow History Synthesis</label>
                                                        <p class="text-xs text-gray-400 mt-1">Let agent answer from conversation history without calling tools (default: enabled)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="force-sub-summary" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="force-sub-summary" class="block text-sm font-semibold text-white cursor-pointer">Force Sub-Executor Summaries</label>
                                                        <p class="text-xs text-gray-400 mt-1">Require sub-executors to generate their own summaries (default: disabled)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="condense-prompts" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="condense-prompts" class="block text-sm font-semibold text-white cursor-pointer">Condense System Prompts</label>
                                                        <p class="text-xs text-gray-400 mt-1">Compress tool/prompt lists in subsequent turns to save tokens (default: enabled)</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Query Optimization -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Query Optimization</h3>
                                                    <p class="text-sm text-gray-400">SQL consolidation and query rewriting</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-sql-consolidation" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="enable-sql-consolidation" class="block text-sm font-semibold text-white cursor-pointer">Enable SQL Consolidation</label>
                                                        <p class="text-xs text-gray-400 mt-1">Use LLM to consolidate sequential SQL queries for better performance (default: disabled)</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Security Settings -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Security Settings</h3>
                                                    <p class="text-sm text-gray-400">Session and authentication parameters</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div>
                                                <label for="session-timeout" class="block text-sm font-medium text-gray-300 mb-2">Session Timeout (hours)</label>
                                                <input type="number" id="session-timeout" min="1" max="168" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">How long sessions remain valid (default: 24)</p>
                                            </div>
                                            <div>
                                                <label for="token-expiry" class="block text-sm font-medium text-gray-300 mb-2">Token Expiry (hours)</label>
                                                <input type="number" id="token-expiry" min="1" max="720" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Authentication token validity period (default: 168)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- System Maintenance -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">System Maintenance</h3>
                                                    <p class="text-sm text-gray-400">Cache management and system operations</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg">
                                                <div>
                                                    <h4 class="text-sm font-semibold text-white mb-1">Clear Application Cache</h4>
                                                    <p class="text-xs text-gray-400">Clears temporary data and cached responses</p>
                                                </div>
                                                <button type="button" id="clear-cache-btn" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-md transition-colors text-white font-medium text-sm">
                                                    Clear Cache
                                                </button>
                                            </div>
                                            <div class="flex items-center justify-between p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
                                                <div>
                                                    <h4 class="text-sm font-semibold text-red-400 mb-1">Reset Application State</h4>
                                                    <p class="text-xs text-gray-400">Resets runtime state (requires reconnection)</p>
                                                </div>
                                                <button type="button" id="reset-state-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-md transition-colors text-white font-medium text-sm">
                                                    Reset State
                                                </button>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Save Button -->
                                <div class="flex justify-end">
                                    <button type="button" id="save-expert-settings-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                        </svg>
                                        Save Expert Settings
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 6: System Prompts -->
                        <div id="system-prompts-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="mb-6">
                                        <h3 class="text-xl font-bold text-white">System Prompt Editor</h3>
                                        <p class="text-sm text-gray-400 mt-1">Manage system prompts for different profile tiers</p>
                                        <div id="system-prompts-tier-notice" class="mt-4 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30 hidden">
                                            <div class="flex items-start gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                                </svg>
                                                <div class="flex-1">
                                                    <p class="text-sm font-medium text-yellow-200">License Tier Required</p>
                                                    <p class="text-xs text-yellow-300/80 mt-1">System Prompt Editor requires "Prompt Engineer" or "Enterprise" license tier.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- System Prompt Selector -->
                                    <div class="mb-6">
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Select System Prompt</label>
                                        <select id="system-prompts-tier-selector" class="w-full px-4 py-2 rounded-lg text-white bg-gray-700 border border-gray-600 focus:outline-none focus:border-teradata-orange transition-colors">
                                            <optgroup label="Master System Prompts">
                                                <option value="MASTER_SYSTEM_PROMPT">Master System Prompt (Default)</option>
                                                <option value="GOOGLE_MASTER_SYSTEM_PROMPT">Google Master System Prompt</option>
                                                <option value="OLLAMA_MASTER_SYSTEM_PROMPT">Ollama Master System Prompt</option>
                                            </optgroup>
                                            <optgroup label="Workflow & Classification">
                                                <option value="TASK_CLASSIFICATION_PROMPT">Task Classification Prompt</option>
                                                <option value="WORKFLOW_META_PLANNING_PROMPT">Workflow Meta Planning Prompt</option>
                                                <option value="WORKFLOW_TACTICAL_PROMPT">Workflow Tactical Prompt</option>
                                            </optgroup>
                                            <optgroup label="Error Recovery & Self-Correction">
                                                <option value="ERROR_RECOVERY_PROMPT">Error Recovery Prompt</option>
                                                <option value="TACTICAL_SELF_CORRECTION_PROMPT">Tactical Self-Correction Prompt</option>
                                                <option value="TACTICAL_SELF_CORRECTION_PROMPT_COLUMN_ERROR">Self-Correction: Column Error</option>
                                                <option value="TACTICAL_SELF_CORRECTION_PROMPT_TABLE_ERROR">Self-Correction: Table Error</option>
                                            </optgroup>
                                            <optgroup label="Data Operations">
                                                <option value="SQL_CONSOLIDATION_PROMPT">SQL Consolidation Prompt</option>
                                            </optgroup>
                                            <optgroup label="Visualization">
                                                <option value="G2PLOT_GUIDELINES">G2Plot Guidelines</option>
                                            </optgroup>
                                        </select>
                                    </div>

                                    <!-- System Prompt Editor -->
                                    <div class="mb-6">
                                        <div class="flex justify-between items-center mb-2">
                                            <div class="flex items-center gap-2">
                                                <label class="block text-sm font-medium text-gray-300">System Prompt Content</label>
                                                <span id="system-prompt-override-badge" class="hidden px-2 py-0.5 text-xs font-medium bg-[#F15F22] text-white rounded">
                                                    Custom Override
                                                </span>
                                            </div>
                                            <p class="text-xs text-gray-500">
                                                <span id="system-prompt-char-count">0</span> characters
                                            </p>
                                        </div>
                                        <textarea id="system-prompt-editor-textarea" rows="20" 
                                                  class="w-full px-4 py-3 rounded-lg text-white bg-gray-700 border border-gray-600 focus:outline-none focus:border-teradata-orange transition-colors font-mono text-sm resize-y"
                                                  placeholder="Select a system prompt to edit..."></textarea>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="flex justify-between items-center">
                                        <button type="button" id="load-system-prompt-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                            </svg>
                                            Load Current Prompt
                                        </button>
                                        <div class="flex gap-2">
                                            <button type="button" id="reset-system-prompt-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium text-sm">
                                                Reset to Default
                                            </button>
                                            <button type="button" id="save-system-prompt-btn" class="px-6 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                                </svg>
                                                Save System Prompt
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- --- END: Administration View --- -->

        </main>
    </div>
    <!-- Main content wrapper closing div -->


    <!-- Modals (Chat, Info, Config, Prompt Editor, Confirmation, Prompt View, System Prompt Popup, User Management) -->
    <!-- All modals remain at the end of <body> to overlay all views -->
    
    <!-- Change Password Modal -->
    <div id="change-password-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="glass-panel rounded-xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Change Password</h3>
                <button type="button" id="change-password-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <form id="change-password-form" class="space-y-4">
                <div>
                    <label for="current-password" class="block text-sm font-medium text-gray-300 mb-2">Current Password</label>
                    <input type="password" id="current-password" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter current password">
                </div>
                
                <div>
                    <label for="new-password" class="block text-sm font-medium text-gray-300 mb-2">New Password</label>
                    <input type="password" id="new-password" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter new password">
                    <p class="text-xs text-gray-400 mt-1">Minimum 8 characters</p>
                </div>
                
                <div>
                    <label for="confirm-password" class="block text-sm font-medium text-gray-300 mb-2">Confirm New Password</label>
                    <input type="password" id="confirm-password" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Confirm new password">
                </div>
                
                <div class="flex gap-2 pt-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium">
                        Change Password
                    </button>
                    <button type="button" id="change-password-form-cancel" class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- User Management Modal -->
    <div id="user-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="glass-panel rounded-xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 id="user-modal-title" class="text-xl font-bold text-white">Create User</h3>
                <button type="button" id="user-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <form id="user-form" class="space-y-4">
                <input type="hidden" id="user-form-id" value="">
                
                <div>
                    <label for="user-form-username" class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                    <input type="text" id="user-form-username" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter username">
                </div>
                
                <div>
                    <label for="user-form-email" class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                    <input type="email" id="user-form-email" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter email">
                </div>
                
                <div>
                    <label for="user-form-display-name" class="block text-sm font-medium text-gray-300 mb-2">Display Name</label>
                    <input type="text" id="user-form-display-name"
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter display name (optional)">
                </div>
                
                <div id="user-form-password-container">
                    <label for="user-form-password" class="block text-sm font-medium text-gray-300 mb-2">
                        Password <span id="password-optional-text" class="text-xs text-gray-500">(leave blank to keep current)</span>
                    </label>
                    <input type="password" id="user-form-password" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter password">
                    <p class="text-xs text-gray-400 mt-1">Minimum 8 characters</p>
                </div>
                
                <div>
                    <label for="user-form-tier" class="block text-sm font-medium text-gray-300 mb-2">Profile Tier</label>
                    <select id="user-form-tier" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="user">User</option>
                        <option value="developer">Developer</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                
                <div class="flex gap-2 pt-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium">
                        Save
                    </button>
                    <button type="button" id="user-form-cancel" class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chat-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="chat-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-2xl p-6 transform scale-95 opacity-0 flex flex-col" style="height: 80vh;">
            <!-- Chat Modal Content -->
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold header-title">Direct Chat with Model</h3>
                <button type="button" id="chat-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="chat-modal-log" class="flex-1 w-full p-3 bg-gray-800/80 border border-gray-600 rounded-md overflow-y-auto space-y-4">
            </div>
            <form id="chat-modal-form" class="mt-4 flex items-center gap-3">
                <input type="text" id="chat-modal-input" placeholder="Send a message..."
                    class="flex-1 p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teradata-orange text-white placeholder-gray-400"
                    autocomplete="off" />
                <button type="submit" id="chat-modal-submit"
                    class="p-3 bg-teradata-orange rounded-lg hover:bg-teradata-orange-dark flex items-center justify-center w-12 h-12 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                </button>
            </form>
        </div>
    </div>
    <!-- Info Modal -->
    <div id="info-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="info-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Info Modal Content -->
            <h3 class="text-xl font-bold mb-4 header-title">About This Project</h3>
            <div class="text-gray-300 space-y-4 text-sm">
                <!-- Project details -->
                <div>
                    <h4 class="font-semibold text-white mb-2">Overview</h4>
                    <p class="mb-4">The <strong>Trusted Data Agent</strong> represents a paradigm shift in data interaction, taking you from question to insight to action in seconds. Experience the industry-leading AI conversational engine for your most complex enterprise data.</p>
                    <p>Go from conversational discovery to a production-ready, automated workflow with zero friction. It represents a fundamental change in how you work, moving <strong>from days to seconds</strong>, <strong>from guesswork to clarity</strong>, and <strong>from high cost to high efficiency</strong>, while always ensuring <strong>data sovereignty</strong>.</p>
                    
                    <hr class="border-white/10 my-4">

                    <h4 class="font-semibold text-white mb-2">Core Principles: A Superior Approach</h4>
                    <p class="mb-4">The Trusted Data Agent transcends typical data chat applications by delivering a seamless and powerful experience based on four core principles:</p>
                    <ul class="space-y-3 list-disc list-inside">
                        <li><strong>Actionable:</strong> Go from conversational discovery to a production-ready, automated workflow in seconds. Your interactive queries can be immediately operationalized via a REST API, eliminating the friction of traditional data operations.</li>
                        <li><strong>Transparent:</strong> Eliminate the "black box" of AI. The Live Status Window shows every step of the agent's thought process, from the high-level plan to every tool execution and self-correction, providing a clear, real-time view.</li>
                        <li><strong>Efficient:</strong> The intelligent Fusion Optimizer uses a multi-layered architecture for resilient and cost-effective task execution, ensuring enterprise-grade performance through strategic planning, proactive optimization, and autonomous self-correction.</li>
                        <li><strong>Sovereignty:</strong> Your data, your rules, your environment. Leverage hyperscaler LLMs or run private models on your own infrastructure with Ollama, keeping your data governed entirely by your rules.</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold text-white mb-1">Source Code & Contributions</h4>
                    <p>The Trusted Data Agent is open source and contributions are welcome. Please visit the main git project to report issues or submit pull requests.</p>
                    <p class="mt-2"><strong>Git Repository:</strong> <a href="https://github.com/rgeissen/trusted-data-agent.git" target="_blank" class="text-teradata-orange hover:underline">https://github.com/rgeissen/trusted-data-agent.git</a></p>
                </div>
                <hr class="border-white/10 my-4">
                <div>
                    <p class="text-xs text-gray-400">Trusted Data Agent Author/Initiator</p>
                    <p class="font-semibold text-white">Rainer Geissendoerfer, World-Wide Data Architecture, <Teradata class="com">Teradata</Teradata></p>
                </div>
            </div>
            <div class="flex justify-end mt-6">
                <button id="info-modal-close" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Add RAG Collection Modal -->
    <div id="add-rag-collection-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="add-rag-collection-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-3xl p-6 transform scale-95 opacity-0 max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white">Add RAG Collection</h2>
                <button type="button" id="add-rag-collection-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="add-rag-collection-form" class="space-y-4">
                <div>
                    <label for="rag-collection-name" class="block text-sm font-medium text-gray-300 mb-2">
                        Collection Name <span class="text-red-400">*</span>
                    </label>
                    <input type="text" id="rag-collection-name" name="name" required
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                           placeholder="e.g., Teradata Query Patterns">
                </div>
                
                <div>
                    <label for="rag-collection-mcp-server" class="block text-sm font-medium text-gray-300 mb-2">
                        Associated MCP Server <span class="text-red-400">*</span>
                    </label>
                    <select id="rag-collection-mcp-server" name="mcp_server_name" required
                            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white">
                        <option value="">Select an MCP Server...</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                    <p class="mt-1 text-xs text-gray-400">This collection will store RAG cases for the selected MCP server</p>
                </div>
                
                <div>
                    <label for="rag-collection-description" class="block text-sm font-medium text-gray-300 mb-2">
                        Description (Optional)
                    </label>
                    <textarea id="rag-collection-description" name="description" rows="3"
                              class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white resize-none"
                              placeholder="Brief description of this collection's purpose..."></textarea>
                </div>

                <!-- Separator -->
                <div class="border-t border-gray-600 pt-4"></div>

                <!-- Population Options -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-medium text-gray-300">Collection Population</h3>
                        <span class="text-xs text-gray-500">Optional</span>
                    </div>
                    <p class="text-xs text-gray-400 mb-3">Choose how to populate the collection with initial examples</p>
                    
                    <!-- Level 1: Population Decision -->
                    <div class="space-y-2 mb-4">
                        <label class="flex items-center gap-3 p-3 bg-gray-700/30 rounded-lg border border-gray-600 cursor-pointer hover:border-teradata-orange/50 transition-colors">
                            <input type="radio" name="population-decision" value="none" id="rag-population-none" checked
                                   class="w-4 h-4 text-teradata-orange focus:ring-2 focus:ring-teradata-orange">
                            <div>
                                <div class="text-sm font-medium text-gray-300">No Population</div>
                                <div class="text-xs text-gray-400">Create empty collection</div>
                            </div>
                        </label>
                        
                        <label class="flex items-center gap-3 p-3 bg-gray-700/30 rounded-lg border border-gray-600 cursor-pointer hover:border-teradata-orange/50 transition-colors">
                            <input type="radio" name="population-decision" value="template" id="rag-population-with-template"
                                   class="w-4 h-4 text-teradata-orange focus:ring-2 focus:ring-teradata-orange">
                            <div>
                                <div class="text-sm font-medium text-gray-300">Populate with Template</div>
                                <div class="text-xs text-gray-400">Use a template to add initial examples</div>
                            </div>
                        </label>
                    </div>
                    
                    <!-- Level 2: Template Options (shown when "Populate with Template" is selected) -->
                    <div id="rag-collection-template-options" class="hidden space-y-4 bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                        <!-- Template Type Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Template Type</label>
                            <select id="rag-collection-template-type" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white text-sm">
                                <option value="">Loading templates...</option>
                            </select>
                        </div>

                        <!-- Population Method: Manual vs Auto-generate -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Population Method</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3 p-2 bg-gray-700/50 rounded-lg border border-gray-600 cursor-pointer hover:border-teradata-orange/50 transition-colors">
                                    <input type="radio" name="template-population-method" value="manual" id="rag-template-method-manual" checked
                                           class="w-4 h-4 text-teradata-orange focus:ring-2 focus:ring-teradata-orange">
                                    <div>
                                        <div class="text-sm font-medium text-gray-300">Manual Entry</div>
                                        <div class="text-xs text-gray-400">Manually enter question/SQL pairs</div>
                                    </div>
                                </label>
                                
                                <label class="flex items-center gap-3 p-2 bg-gray-700/50 rounded-lg border border-gray-600 cursor-pointer hover:border-teradata-orange/50 transition-colors" id="rag-template-method-llm-label">
                                    <input type="radio" name="template-population-method" value="auto-generate" id="rag-template-method-llm"
                                           class="w-4 h-4 text-teradata-orange focus:ring-2 focus:ring-teradata-orange">
                                    <div class="flex-1">
                                        <div class="text-sm font-medium text-gray-300">Auto-generate with LLM</div>
                                        <div class="text-xs text-gray-400">LLM generates examples from context</div>
                                    </div>
                                    <span id="rag-template-method-llm-badge" class="hidden px-2 py-0.5 bg-yellow-500/20 text-yellow-400 text-xs rounded">Template Required</span>
                                </label>
                            </div>
                        </div>

                        <!-- Manual Entry Fields -->
                        <div id="rag-collection-manual-fields" class="space-y-3">
                            <!-- SQL Template Specific Fields -->
                            <div id="rag-collection-sql-template-fields" class="space-y-3 template-fields">
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-xs text-gray-400 mb-1">Database Name</label>
                                        <input type="text" id="rag-collection-template-db" 
                                               class="w-full p-2 bg-gray-600 border border-gray-500 rounded-md focus:ring-2 focus:ring-teradata-orange outline-none text-white text-sm"
                                               placeholder="e.g., production_db">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-400 mb-1">MCP Tool Name</label>
                                        <input type="text" id="rag-collection-template-tool" readonly
                                               class="w-full p-2 bg-gray-600 border border-gray-500 rounded-md text-gray-400 text-sm"
                                               placeholder="Loading...">
                                        <p class="text-xs text-gray-500 mt-1">From template configuration</p>
                                    </div>
                                </div>

                                <!-- Examples -->
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="block text-xs font-medium text-gray-300">SQL Examples</label>
                                        <button type="button" id="rag-collection-template-add-example" class="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                            </svg>
                                            Add Example
                                        </button>
                                    </div>
                                    <div id="rag-collection-template-examples" class="space-y-2 max-h-60 overflow-y-auto">
                                        <!-- Examples will be added here dynamically -->
                                    </div>
                                </div>
                            </div>

                            <!-- API Template Specific Fields (hidden by default) -->
                            <div id="rag-collection-api-template-fields" class="space-y-3 template-fields hidden">
                                <p class="text-sm text-gray-400">API Call template configuration will be available soon.</p>
                            </div>

                            <!-- Custom Template Specific Fields (hidden by default) -->
                            <div id="rag-collection-custom-template-fields" class="space-y-3 template-fields hidden">
                                <p class="text-sm text-gray-400">Custom template configuration will be available soon.</p>
                            </div>
                        </div>

                        <!-- LLM Workflow Container (hidden when not using LLM generation) -->
                        <div id="rag-collection-llm-workflow" class="hidden space-y-4">
                            <!-- Auto-generate with LLM Fields (dynamically generated from template manifest) -->
                            <div id="rag-collection-llm-fields" class="space-y-3">
                                <!-- Fields will be dynamically generated based on template's population_modes.auto_generate.input_variables -->
                            </div>
                            
                            <!-- Question Generation Prompt Preview -->
                            <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-600">
                                <div class="flex items-center justify-between mb-2">
                                <label class="text-sm font-medium text-gray-300 flex items-center gap-2">
                                    <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    Question Generation Prompt (Preview)
                                </label>
                                <button type="button" id="rag-collection-refresh-prompt" 
                                        class="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1"
                                        title="Refresh prompt preview with current values">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                                <textarea id="rag-collection-llm-prompt-preview" 
                                          class="w-full h-32 p-3 bg-gray-900/50 border border-gray-700 rounded text-xs font-mono text-gray-300 resize-none"
                                          placeholder="Enter subject, count, and database above, then click Refresh to preview the prompt..."></textarea>
                                <p class="text-xs text-gray-400 mt-2">This prompt will be sent to the LLM along with the database context. You can edit it if needed.</p>
                            </div>
                        
                        <!-- Generate Context Button -->
                        <div class="pt-3 border-t border-gray-600">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center text-white text-xs font-bold">1</div>
                                <p class="text-sm font-semibold text-blue-300">Generate database context to help the LLM understand your schema</p>
                            </div>
                            <button type="button" id="rag-collection-generate-context" 
                                    class="w-full px-4 py-3 rounded-md bg-blue-600 hover:bg-blue-500 transition-colors font-semibold text-white text-sm flex items-center justify-center gap-2 shadow-lg">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                <span>Generate Context</span>
                            </button>
                        </div>
                        
                        <!-- Context Result (hidden initially) -->
                        <div id="rag-collection-context-result" class="hidden bg-gray-800/50 rounded-lg p-4 border border-gray-600">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="text-sm font-semibold text-white flex items-center gap-2">
                                    <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Database Context Generated
                                </h4>
                                <button type="button" id="rag-collection-view-full-context" class="text-xs px-2 py-1 rounded bg-blue-600 hover:bg-blue-700 text-white mr-2">
                                    View Full Context
                                </button>
                                <button type="button" id="rag-collection-context-close" class="text-gray-400 hover:text-white">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div id="rag-collection-context-content" class="text-xs text-gray-300 font-mono bg-gray-900/50 rounded p-3 max-h-40 overflow-y-auto">
                                <!-- Context summary will be displayed here -->
                            </div>
                        </div>
                        
                        <!-- Step 2: Generate Questions Button (appears after context is generated) -->
                        <div id="rag-collection-step2-section" class="hidden mt-4 pt-4 border-t-2 border-purple-500/30 bg-purple-900/10 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-3">
                                <div class="w-6 h-6 rounded-full bg-purple-600 flex items-center justify-center text-white text-xs font-bold">2</div>
                                <p class="text-sm font-semibold text-purple-300">Generate question/SQL pairs from the database context</p>
                            </div>
                            <button type="button" id="rag-collection-generate-questions-btn" class="w-full flex items-center justify-center gap-2 px-4 py-3 rounded-md bg-purple-600 hover:bg-purple-700 transition-colors font-semibold text-white text-sm shadow-lg">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Generate Questions</span>
                            </button>
                        </div>
                        
                        <!-- Generated Questions Preview (hidden initially) -->
                        <div id="rag-collection-questions-result" class="hidden bg-gray-800/50 rounded-lg p-4 border border-gray-600 mt-3">
                            <div class="flex items-start justify-between mb-3">
                                <h4 class="text-sm font-semibold text-white flex items-center gap-2">
                                    <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <span id="rag-collection-questions-count">5 Questions Generated</span>
                                </h4>
                                <button type="button" id="rag-collection-questions-close" class="text-gray-400 hover:text-white">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- Questions Preview List -->
                            <div id="rag-collection-questions-list" class="space-y-2 max-h-60 overflow-y-auto mb-3">
                                <!-- Questions will be displayed here -->
                            </div>
                            
                            <!-- Populate Collection Button -->
                            <button type="button" id="rag-collection-populate-btn" class="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-md bg-green-600 hover:bg-green-700 transition-colors font-semibold text-white text-sm">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                </svg>
                                <span>Populate Collection</span>
                            </button>
                        </div>
                        
                        <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
                            <div class="flex gap-2">
                                <svg class="w-4 h-4 text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <p class="text-xs text-blue-300">The LLM will analyze your subject and generate realistic question/SQL pairs. Generation may take 30-60 seconds.</p>
                            </div>
                        </div>
                        </div>
                        <!-- End LLM Workflow Container -->
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-600">
                    <button type="button" id="add-rag-collection-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="add-rag-collection-submit" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold text-white">
                        Create Collection
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Template Editor Modal -->
    <div id="template-editor-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="template-editor-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-3xl p-6 transform scale-95 opacity-0 max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-white">Edit Template Configuration</h2>
                    <p class="text-sm text-gray-400 mt-1">Customize input variables and default values</p>
                </div>
                <button type="button" id="template-editor-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="template-editor-form" class="space-y-6">
                <!-- Template Info (Dynamic) -->
                <div id="template-editor-info" class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                    <h3 id="template-editor-template-name" class="text-lg font-semibold text-white mb-2">Loading...</h3>
                    <p id="template-editor-template-description" class="text-sm text-gray-400"></p>
                </div>

                <!-- Input Variables Section (Dynamic) -->
                <div id="template-editor-input-variables" class="hidden">
                    <h3 class="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Input Variables
                    </h3>
                    <p class="text-xs text-gray-400 mb-4">Variables that users must provide when using this template</p>
                    <div id="template-editor-input-vars-content" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Configuration Fields (Dynamic) -->
                <div id="template-editor-config-fields">
                    <h3 class="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Configuration
                    </h3>
                    <p class="text-xs text-gray-400 mb-4">Editable configuration values for this template</p>
                    <div id="template-editor-config-content" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Info Notice -->
                <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                    <div class="flex gap-3">
                        <svg class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-sm text-blue-300">
                            <p class="font-medium mb-1">Template Configuration</p>
                            <p class="text-xs text-blue-400">These settings control default values for all cases generated from this template. Users can still override specific values when populating collections.</p>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 pt-4 border-t border-gray-600">
                    <button type="button" id="template-editor-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="template-editor-submit" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold text-white">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit RAG Collection Modal -->
    <div id="edit-rag-collection-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="edit-rag-collection-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white">Edit RAG Collection</h2>
                <button type="button" id="edit-rag-collection-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="edit-rag-collection-form" class="space-y-4">
                <input type="hidden" id="edit-rag-collection-id" name="collection_id">
                
                <div>
                    <label for="edit-rag-collection-name" class="block text-sm font-medium text-gray-300 mb-2">
                        Collection Name <span class="text-red-400">*</span>
                    </label>
                    <input type="text" id="edit-rag-collection-name" name="name" required
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                           placeholder="e.g., Teradata Query Patterns">
                </div>
                
                <div>
                    <label for="edit-rag-collection-mcp-server" class="block text-sm font-medium text-gray-300 mb-2">
                        Associated MCP Server <span class="text-red-400">*</span>
                    </label>
                    <select id="edit-rag-collection-mcp-server" name="mcp_server_name" required
                            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white">
                        <option value="">Select an MCP Server...</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                    <p class="mt-1 text-xs text-gray-400">This collection will store RAG cases for the selected MCP server</p>
                </div>
                
                <div>
                    <label for="edit-rag-collection-description" class="block text-sm font-medium text-gray-300 mb-2">
                        Description (Optional)
                    </label>
                    <textarea id="edit-rag-collection-description" name="description" rows="3"
                              class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white resize-none"
                              placeholder="Brief description of this collection's purpose..."></textarea>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-600">
                    <button type="button" id="edit-rag-collection-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="edit-rag-collection-submit" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold text-white">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- SQL Template Populator Modal -->
    <div id="sql-template-populator-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="sql-template-populator-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-4xl p-6 transform scale-95 opacity-0 max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-white">SQL Template Populator</h2>
                    <p class="text-sm text-gray-400 mt-1">Bulk populate a collection with SQL query examples</p>
                </div>
                <button type="button" id="sql-template-populator-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="sql-template-populator-form" class="space-y-6">
                <!-- Collection Selection -->
                <div>
                    <label for="sql-template-collection-select" class="block text-sm font-medium text-gray-300 mb-2">
                        Target Collection <span class="text-red-400">*</span>
                    </label>
                    <select id="sql-template-collection-select" name="collection_id" required
                            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white">
                        <option value="">Select a collection...</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                    <p class="mt-1 text-xs text-gray-400">Cases will be added to this collection</p>
                </div>

                <!-- Optional Fields -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="sql-template-database-name" class="block text-sm font-medium text-gray-300 mb-2">
                            Database Name (Optional)
                        </label>
                        <input type="text" id="sql-template-database-name" name="database_name"
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                               placeholder="e.g., production_db">
                    </div>
                    <div>
                        <label for="sql-template-target-database" class="block text-sm font-medium text-gray-300 mb-2">
                            Target Database System
                        </label>
                        <input type="text" id="sql-template-target-database" name="target_database"
                               value="Teradata"
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                               placeholder="e.g., Teradata, PostgreSQL, MySQL">
                    </div>
                </div>
                <div>
                    <label for="sql-template-mcp-tool" class="block text-sm font-medium text-gray-300 mb-2">
                        MCP Tool Name (Optional)
                    </label>
                    <input type="text" id="sql-template-mcp-tool" name="mcp_tool_name"
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                           placeholder="Loading...">
                </div>

                <!-- Examples Input -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-gray-300">
                            SQL Examples <span class="text-red-400">*</span>
                        </label>
                        <button type="button" id="sql-template-add-example" class="text-sm text-blue-400 hover:text-blue-300 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Add Example
                        </button>
                    </div>
                    <div id="sql-template-examples-container" class="space-y-4">
                        <!-- Example rows will be added dynamically -->
                    </div>
                    <p class="mt-2 text-xs text-gray-400">
                        Each example consists of a user question and the corresponding SQL statement
                    </p>
                </div>

                <!-- Instructions -->
                <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <svg class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-sm text-blue-300 space-y-1">
                            <p class="font-medium">How it works:</p>
                            <ul class="list-disc list-inside space-y-1 text-blue-400">
                                <li>Each example creates a two-phase RAG case: Execute SQL  Generate Report</li>
                                <li>Cases are marked as "champion" by default (is_most_efficient: true)</li>
                                <li>The agent will use these examples for similar queries in the future</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Progress/Results Area (hidden initially) -->
                <div id="sql-template-results" class="hidden">
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-white mb-2">Population Results</h3>
                        <div id="sql-template-results-content" class="text-sm text-gray-300 space-y-1">
                            <!-- Results will be shown here -->
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 pt-4 border-t border-gray-600">
                    <button type="button" id="sql-template-populator-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="sql-template-populator-submit" class="px-4 py-2 rounded-md bg-[#F15F22] hover:bg-[#D9501A] transition-colors font-semibold text-white">
                        Populate Collection
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- MODIFICATION: Config Modal Overlay is REMOVED -->
    <!-- <div id="config-modal-overlay" ... > ... </div> -->

    <!-- Prompt Editor Modal -->
    <div id="prompt-editor-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="prompt-editor-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-3xl p-6 transform scale-95 opacity-0 flex flex-col" style="height: 80vh;">
            <!-- Prompt Editor Modal Content -->
            <div class="flex justify-between items-center mb-4">
                <h3 id="prompt-editor-title" class="text-xl font-bold header-title">System Prompt Editor</h3>
                <div id="prompt-editor-status" class="text-sm"></div>
            </div>
            <textarea id="prompt-editor-textarea" class="flex-1 w-full p-3 bg-gray-800/80 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none font-mono text-sm"></textarea>
            <div class="flex justify-between items-center mt-4">
                <button type="button" id="prompt-editor-reset" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors">Reset to Default</button>
                <div>
                    <button type="button" id="prompt-editor-close" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors mr-2">Close</button>
                    <button type="button" id="prompt-editor-save" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="confirm-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Confirmation Modal Content -->
            <h3 id="confirm-modal-title" class="text-xl font-bold mb-4">Confirm Action</h3>
            <p id="confirm-modal-body" class="text-gray-300 mb-6"></p>
            <div class="flex justify-end gap-3">
                <button type="button" id="confirm-modal-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors">Cancel</button>
                <button type="button" id="confirm-modal-confirm" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Prompt Invocation/Correction Modal -->
    <div id="prompt-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="prompt-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Prompt Invocation/Correction Modal Content -->
            <h3 id="prompt-modal-title" class="text-xl font-bold mb-4"></h3>
            <form id="prompt-modal-form">
                <div id="prompt-modal-inputs" class="space-y-4 mb-6"></div>
                <div class="flex justify-end gap-3">
                    <button type="button" id="prompt-modal-close" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors">Cancel</button>
                    <button type="submit" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Run</button>
                </div>
            </form>
        </div>
    </div>

    <!-- System Prompt Popup - DEPRECATED: Content migrated to main welcome screen -->
    <!-- <div id="system-prompt-popup-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="system-prompt-popup-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-3xl p-6 transform scale-95 opacity-0 flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="system-prompt-popup-title" class="text-xl font-bold header-title">Welcome to the Trusted Data Agent</h3>
            </div>
            <div id="system-prompt-popup-body" class="flex-1 w-full p-3 bg-gray-800/80 border border-gray-600 rounded-md overflow-y-auto">
            </div>
            <div class="flex justify-between items-center mt-4">
                <label class="flex items-center gap-x-2 text-sm text-gray-400 cursor-pointer">
                    <input type="checkbox" id="welcome-screen-show-at-startup-checkbox-old" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                    <span>Show this screen at startup</span>
                </label>
                <div>
                    <button type="button" id="system-prompt-popup-view-full" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors">View Full System Prompt</button>
                    <button type="button" id="system-prompt-popup-close" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold ml-2">Close</button>
                </div>
            </div>
        </div>
    </div> -->

    <!-- Context Result Modal -->
    <div id="context-result-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="context-result-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-4xl p-6 transform scale-95 opacity-0 max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-white">Database Context Result</h2>
                    <p class="text-sm text-gray-400 mt-1">Raw context data retrieved from MCP prompt execution</p>
                </div>
                <button type="button" id="context-result-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="space-y-4">
                <!-- Prompt Text -->
                <div>
                    <h3 class="text-sm font-semibold text-white mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                        </svg>
                        Executed Prompt
                    </h3>
                    <div id="context-result-prompt-text" class="bg-gray-800/50 rounded-lg p-3 text-xs text-gray-300 font-mono max-h-40 overflow-y-auto"></div>
                </div>

                <!-- Final Answer -->
                <div>
                    <h3 class="text-sm font-semibold text-white mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Final Answer
                    </h3>
                    <div id="context-result-final-answer" class="bg-gray-800/50 rounded-lg p-3 text-xs text-gray-300 max-h-60 overflow-y-auto whitespace-pre-wrap"></div>
                </div>

                <!-- Context for Question Generation -->
                <div>
                    <h3 class="text-sm font-semibold text-white mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Context for Question Generation
                        <span class="text-xs text-gray-400">(What will be sent to the LLM)</span>
                    </h3>
                    <div id="context-result-question-context" class="bg-gray-800/50 rounded-lg p-3 text-xs text-gray-300 max-h-80 overflow-y-auto whitespace-pre-wrap"></div>
                </div>

                <!-- Token Usage -->
                <div class="grid grid-cols-3 gap-3">
                    <div class="bg-gray-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400 mb-1">Input Tokens</p>
                        <p id="context-result-input-tokens" class="text-lg font-semibold text-white">0</p>
                    </div>
                    <div class="bg-gray-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400 mb-1">Output Tokens</p>
                        <p id="context-result-output-tokens" class="text-lg font-semibold text-white">0</p>
                    </div>
                    <div class="bg-gray-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400 mb-1">Total Tokens</p>
                        <p id="context-result-total-tokens" class="text-lg font-semibold text-white">0</p>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-600">
                <button type="button" id="context-result-modal-ok" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold text-white">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- View Prompt Modal -->
    <div id="view-prompt-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="view-prompt-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-3xl p-6 transform scale-95 opacity-0 flex flex-col" style="height: 80vh;">
            <!-- View Prompt Modal Content -->
            <div class="flex justify-between items-center mb-4">
                <h3 id="view-prompt-modal-title" class="text-xl font-bold header-title"></h3>
            </div>
            <div class="flex-1 w-full p-3 bg-gray-800/80 border border-gray-600 rounded-md overflow-y-auto">
                <pre id="view-prompt-modal-text" class="font-mono text-sm whitespace-pre-wrap"></pre>
            </div>
            <div class="flex justify-end items-center mt-4">
                <button type="button" id="view-prompt-modal-close" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/executionDashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/templateManager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/adminManager.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}?v=2.6"></script>
    <script type="module" src="{{ url_for('static', filename='js/handlers/ragCollectionManagement.js') }}"></script>
    <!-- RAG Case Modal -->
    <div id="rag-case-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="rag-case-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-4xl p-6 transform scale-95 opacity-0 flex flex-col" style="height: 90vh;">
            <div class="flex justify-between items-center mb-4">
                <h3 id="rag-case-modal-title" class="text-xl font-bold header-title">RAG Case Details: <span id="rag-case-id-display"></span></h3>
                <button type="button" id="rag-case-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="flex-1 w-full p-3 bg-gray-800/80 border border-gray-600 rounded-md overflow-y-auto">
                <pre id="rag-case-modal-json" class="font-mono text-sm whitespace-pre-wrap text-white"></pre>
            </div>
            <div class="flex justify-end items-center mt-4">
                <button type="button" id="rag-case-modal-copy" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors mr-2">Copy to Clipboard</button>
                <button type="button" id="rag-case-modal-close-bottom" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Close</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Profile Modal -->
    <div id="profile-modal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="glass-panel rounded-lg p-0 max-w-3xl w-full mx-4 shadow-xl overflow-hidden">
            <!-- Modal Header -->
            <div class="bg-gray-800/80 border-b border-gray-700/50 px-6 py-4">
                <h3 class="text-lg font-semibold text-gray-100" id="profile-modal-title">Edit Profile</h3>
                <p class="text-gray-400 text-xs mt-1">Configure your agent profile with LLM, tools, and resources</p>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 space-y-5 max-h-[calc(100vh-250px)] overflow-y-auto">
                <!-- Basic Info Section -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1.5">
                            Profile Name
                        </label>
                        <input type="text" id="profile-modal-name" placeholder="e.g., Production Environment" 
                               class="w-full px-3 py-2 bg-gray-800/40 border border-gray-700/50 rounded-md 
                                      focus:ring-1 focus:ring-gray-500 focus:border-gray-500 outline-none transition-all
                                      placeholder-gray-600 text-gray-200 text-sm hover:border-gray-600/50">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1.5">
                            Profile Tag <span class="text-gray-500 text-xs">(editable)</span>
                        </label>
                        <div class="flex items-center gap-2">
                            <div class="flex-1 flex items-center gap-2 px-3 py-2 bg-gray-800/40 border border-gray-700/50 rounded-md 
                                        hover:border-gray-600/50 transition-all">
                                <span class="text-[#F15F22] font-mono text-sm">@</span>
                                <input type="text" id="profile-modal-tag" placeholder="" maxlength="5"
                                       class="flex-1 bg-transparent border-none outline-none text-gray-200 text-sm font-mono uppercase"
                                       style="text-transform: uppercase;">
                            </div>
                            <button id="profile-modal-generate-tag" 
                                    class="px-3 py-2 bg-gray-700/40 hover:bg-gray-700/60 border border-gray-600/50 rounded-md 
                                           text-gray-300 text-xs font-medium transition-all whitespace-nowrap"
                                    title="Generate tag from configuration">
                                 Generate
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1.5">
                            Description
                        </label>
                        <textarea id="profile-modal-description" rows="2" placeholder="A short description of the profile's purpose..." 
                                  class="w-full px-3 py-2 bg-gray-800/40 border border-gray-700/50 rounded-md 
                                         focus:ring-1 focus:ring-gray-500 focus:border-gray-500 outline-none transition-all
                                         placeholder-gray-600 text-gray-200 text-sm hover:border-gray-600/50 resize-none"></textarea>
                    </div>
                </div>

                <!-- Provider Configuration Section -->
                <div class="border-t border-gray-800/50 pt-5">
                    <h4 class="text-sm font-medium text-gray-300 mb-3">
                        Provider Configuration
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1.5">LLM Configuration</label>
                            <select id="profile-modal-llm-provider" 
                                    class="w-full px-3 py-2 bg-gray-800/40 border border-gray-700/50 rounded-md 
                                           focus:ring-1 focus:ring-gray-500 focus:border-gray-500 outline-none transition-all
                                           text-gray-200 text-sm hover:border-gray-600/50 cursor-pointer"></select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1.5">MCP Server</label>
                            <select id="profile-modal-mcp-server" 
                                    class="w-full px-3 py-2 bg-gray-800/40 border border-gray-700/50 rounded-md 
                                           focus:ring-1 focus:ring-gray-500 focus:border-gray-500 outline-none transition-all
                                           text-gray-200 text-sm hover:border-gray-600/50 cursor-pointer"></select>
                        </div>
                    </div>
                </div>

                <!-- MCP Resources Section -->
                <div class="border-t border-gray-800/50 pt-5">
                    <h4 class="text-sm font-medium text-gray-300 mb-3">
                        MCP Resources
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <div class="flex items-center justify-between mb-1.5">
                                <label class="block text-xs font-medium text-gray-400">Available Tools</label>
                                <button id="profile-modal-tools-uncheck-all" 
                                        class="px-2 py-0.5 text-xs text-gray-400 hover:text-gray-200 
                                               hover:bg-gray-700/30 rounded transition-all">
                                    Uncheck All
                                </button>
                            </div>
                            <div id="profile-modal-tools" 
                                 class="max-h-40 overflow-y-auto px-3 py-2 bg-gray-800/20 border border-gray-700/30 rounded-md 
                                        hover:border-gray-700/40 transition-all custom-scrollbar"></div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-1.5">
                                <label class="block text-xs font-medium text-gray-400">Available Prompts</label>
                                <button id="profile-modal-prompts-uncheck-all" 
                                        class="px-2 py-0.5 text-xs text-gray-400 hover:text-gray-200 
                                               hover:bg-gray-700/30 rounded transition-all">
                                    Uncheck All
                                </button>
                            </div>
                            <div id="profile-modal-prompts" 
                                 class="max-h-40 overflow-y-auto px-3 py-2 bg-gray-800/20 border border-gray-700/30 rounded-md 
                                        hover:border-gray-700/40 transition-all custom-scrollbar"></div>
                        </div>
                    </div>
                </div>

                <!-- RAG Collections Section -->
                <div class="border-t border-gray-800/50 pt-5">
                    <h4 class="text-sm font-medium text-gray-300 mb-3">
                        RAG Collections
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1.5">Query Collections</label>
                            <div id="profile-modal-rag-collections" 
                                 class="max-h-40 overflow-y-auto px-3 py-2 bg-gray-800/20 border border-gray-700/30 rounded-md 
                                        hover:border-gray-700/40 transition-all custom-scrollbar"></div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1.5">Autocomplete Collections</label>
                            <div id="profile-modal-autocomplete-collections" 
                                 class="max-h-40 overflow-y-auto px-3 py-2 bg-gray-800/20 border border-gray-700/30 rounded-md 
                                        hover:border-gray-700/40 transition-all custom-scrollbar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="bg-gray-800/40 border-t border-gray-700/50 px-6 py-4 flex gap-3">
                <button id="profile-modal-cancel" 
                        class="flex-1 px-4 py-2 bg-gray-700/30 hover:bg-gray-700/50 rounded-md transition-all 
                               text-gray-300 text-sm font-medium border border-gray-600/30 hover:border-gray-600/50">
                    Cancel
                </button>
                <button id="profile-modal-save" 
                        class="flex-1 px-4 py-2 bg-[#F15F22]/90 hover:bg-[#F15F22] rounded-md transition-all 
                               text-white text-sm font-medium shadow-sm">
                    Save Profile
                </button>
            </div>
        </div>
    </div>

    <!-- Authentication Client -->
    <script src="/static/js/auth.js"></script>
    <script>
        // ============================================================================
        // THEME MANAGEMENT
        // ============================================================================
        const ThemeManager = {
            STORAGE_KEY: 'tda-theme',
            DEFAULT_THEME: 'legacy',
            
            /**
             * Initialize theme on page load
             */
            init() {
                // Load saved theme or use default
                const savedTheme = this.getTheme();
                this.applyTheme(savedTheme, false); // false = no transition on init
                
                // Set up theme selector buttons
                this.setupThemeSelectors();
                
                // Update button states
                this.updateButtonStates(savedTheme);
            },
            
            /**
             * Get current theme from localStorage
             */
            getTheme() {
                return localStorage.getItem(this.STORAGE_KEY) || this.DEFAULT_THEME;
            },
            
            /**
             * Save theme to localStorage
             */
            saveTheme(theme) {
                localStorage.setItem(this.STORAGE_KEY, theme);
            },
            
            /**
             * Apply theme to document
             */
            applyTheme(theme, withTransition = true) {
                const body = document.body;
                
                // Disable transitions during initial load
                if (!withTransition) {
                    body.classList.add('no-transition');
                }
                
                // Set theme attribute
                body.setAttribute('data-theme', theme);
                
                // Re-enable transitions after a brief delay
                if (!withTransition) {
                    setTimeout(() => {
                        body.classList.remove('no-transition');
                    }, 50);
                }
                
                console.log(`[ThemeManager] Applied theme: ${theme}`);
            },
            
            /**
             * Switch to a different theme
             */
            switchTheme(theme) {
                this.saveTheme(theme);
                this.applyTheme(theme, true);
                this.updateButtonStates(theme);
                
                // Show notification
                if (window.showNotification) {
                    const themeName = theme.charAt(0).toUpperCase() + theme.slice(1);
                    window.showNotification('success', `Switched to ${themeName} theme`);
                }
            },
            
            /**
             * Set up event listeners for theme selector buttons
             */
            setupThemeSelectors() {
                const selectors = document.querySelectorAll('.theme-selector');
                selectors.forEach(button => {
                    button.addEventListener('click', () => {
                        const theme = button.getAttribute('data-theme');
                        this.switchTheme(theme);
                    });
                });
            },
            
            /**
             * Update button states to show active theme
             */
            updateButtonStates(activeTheme) {
                const selectors = document.querySelectorAll('.theme-selector');
                selectors.forEach(button => {
                    const theme = button.getAttribute('data-theme');
                    if (theme === activeTheme) {
                        button.classList.add('bg-[#F15F22]', 'border-[#F15F22]', 'text-white');
                        button.classList.remove('border-white/20');
                    } else {
                        button.classList.remove('bg-[#F15F22]', 'border-[#F15F22]', 'text-white');
                        button.classList.add('border-white/20');
                    }
                });
            }
        };
        
        // Initialize theme immediately (before DOM ready)
        ThemeManager.init();
        
        // ============================================================================
        // AUTHENTICATION
        // ============================================================================
        // Initialize authentication
        const authClient = new AuthClient();
        
        // Global pane visibility cache
        let paneVisibilityCache = null;
        
        /**
         * Update pane visibility based on user tier and configuration
         */
        async function updatePaneVisibility(userTier = null) {
            try {
                // Get user tier if not provided
                if (!userTier) {
                    const user = authClient.getUser();
                    userTier = user?.profile_tier || 'user';
                }
                
                // Fetch pane visibility configuration
                const token = authClient.getToken();
                if (!token) return;
                
                const response = await fetch('/api/v1/auth/me/panes', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    console.warn('Could not fetch pane visibility config, using defaults');
                    return;
                }
                
                const data = await response.json();
                if (data.status !== 'success' || !data.panes) {
                    console.warn('Invalid pane visibility response');
                    return;
                }
                
                paneVisibilityCache = data.panes;
                
                // Apply visibility to each pane
                const paneMap = {
                    'conversation': 'view-switch-conversation',
                    'executions': 'view-switch-executions',
                    'rag-maintenance': 'view-switch-rag-maintenance',
                    'marketplace': 'view-switch-rag-marketplace',
                    'credentials': 'view-switch-credentials',
                    'admin': 'view-switch-admin'
                };
                
                data.panes.forEach(pane => {
                    const elementId = paneMap[pane.pane_id];
                    if (!elementId) return;
                    
                    const paneElement = document.getElementById(elementId);
                    if (!paneElement) return;
                    
                    // Determine if pane should be visible for this tier
                    let isVisible = false;
                    if (userTier === 'admin') {
                        isVisible = pane.visible_to_admin;
                    } else if (userTier === 'developer') {
                        isVisible = pane.visible_to_developer;
                    } else {
                        isVisible = pane.visible_to_user;
                    }
                    
                    // Show or hide pane
                    if (isVisible) {
                        paneElement.classList.remove('hidden');
                    } else {
                        paneElement.classList.add('hidden');
                    }
                });
                
                console.log(`[PaneVisibility] Updated for ${userTier} tier`);
                
            } catch (error) {
                console.error('Error updating pane visibility:', error);
            }
        }
        
        // Make updatePaneVisibility globally accessible
        window.updatePaneVisibility = updatePaneVisibility;
        
        // Update UI based on authentication state
        function updateAuthUI() {
            const isAuth = authClient.isAuthenticated();
            const user = authClient.getUser();
            
            const userMenuContainer = document.getElementById('user-menu-container');
            const loginButtonContainer = document.getElementById('login-button-container');
            
            if (isAuth && user) {
                // Show user menu
                userMenuContainer.classList.remove('hidden');
                loginButtonContainer.classList.add('hidden');
                
                // Update user info
                const initial = user.display_name ? user.display_name.charAt(0).toUpperCase() : user.username.charAt(0).toUpperCase();
                document.getElementById('user-avatar-initial').textContent = initial;
                document.getElementById('user-display-name').textContent = user.display_name || user.username;
                document.getElementById('user-menu-name').textContent = user.display_name || user.username;
                document.getElementById('user-menu-email').textContent = user.email;
                
                // Check if user has admin privileges and show/hide admin menu
                const adminMenuItem = document.getElementById('view-switch-admin');
                if (adminMenuItem) {
                    // Always check /me endpoint to get current tier and validate token
                    fetch('/api/v1/auth/me', {
                        headers: {
                            'Authorization': `Bearer ${authClient.getToken()}`
                        }
                    })
                    .then(res => {
                        if (res.status === 401) {
                            // Token is invalid or expired, clear session and redirect
                            console.log('Token invalid, clearing session');
                            authClient.clearSession();
                            window.location.href = '/login';
                            return null;
                        }
                        return res.json();
                    })
                    .then(data => {
                        if (!data) return; // Already handled redirect above
                        
                        if (data.status === 'success' && data.user) {
                            // Update cached user data with current info from server
                            authClient.setSession(authClient.getToken(), data.user);
                            
                            // Check if user is admin tier or has is_admin flag
                            if (data.user.profile_tier === 'admin' || data.user.is_admin) {
                                adminMenuItem.classList.remove('hidden');
                            } else {
                                adminMenuItem.classList.add('hidden');
                            }
                            
                            // Update pane visibility based on user tier
                            updatePaneVisibility(data.user.profile_tier);
                        } else {
                            adminMenuItem.classList.add('hidden');
                        }
                    })
                    .catch(err => {
                        console.error('Error checking admin status:', err);
                        // On network error, try to use cached user data
                        if (user.profile_tier === 'admin' || user.is_admin) {
                            adminMenuItem.classList.remove('hidden');
                        } else {
                            adminMenuItem.classList.add('hidden');
                        }
                        // Still try to update pane visibility with cached tier
                        updatePaneVisibility(user.profile_tier);
                    });
                }
                
                console.log('Authenticated as:', user.username);
            } else {
                // Show login button
                userMenuContainer.classList.add('hidden');
                loginButtonContainer.classList.remove('hidden');
                
                // Hide admin menu
                const adminMenuItem = document.getElementById('view-switch-admin');
                if (adminMenuItem) {
                    adminMenuItem.classList.add('hidden');
                }
                
                console.log('Not authenticated');
            }
        }
        
        // Initialize on page load
        updateAuthUI();
        
        // Handle user menu toggle
        const userMenuButton = document.getElementById('user-menu-button');
        const userDropdownMenu = document.getElementById('user-dropdown-menu');
        
        if (userMenuButton && userDropdownMenu) {
            userMenuButton.addEventListener('click', () => {
                userDropdownMenu.classList.toggle('open');
            });
        }
        
        // Handle logout
        const logoutButton = document.getElementById('user-logout-button');
        if (logoutButton) {
            logoutButton.addEventListener('click', async () => {
                const result = await authClient.logout();
                console.log('Logout result:', result);
                window.location.href = '/login';
            });
        }
        
        // Handle profile button (placeholder)
        const profileButton = document.getElementById('user-profile-button');
        if (profileButton) {
            profileButton.addEventListener('click', () => {
                alert('Profile page coming soon!');
            });
        }
        
        // Handle change password button
        const changePasswordButton = document.getElementById('user-change-password-button');
        if (changePasswordButton) {
            changePasswordButton.addEventListener('click', () => {
                document.getElementById('change-password-modal-overlay').classList.remove('hidden');
            });
        }
        
        // Handle change password modal
        const changePasswordModalClose = document.getElementById('change-password-modal-close');
        const changePasswordFormCancel = document.getElementById('change-password-form-cancel');
        const changePasswordForm = document.getElementById('change-password-form');
        
        if (changePasswordModalClose) {
            changePasswordModalClose.addEventListener('click', () => {
                document.getElementById('change-password-modal-overlay').classList.add('hidden');
                changePasswordForm.reset();
            });
        }
        
        if (changePasswordFormCancel) {
            changePasswordFormCancel.addEventListener('click', () => {
                document.getElementById('change-password-modal-overlay').classList.add('hidden');
                changePasswordForm.reset();
            });
        }
        
        if (changePasswordForm) {
            changePasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const currentPassword = document.getElementById('current-password').value;
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                
                if (newPassword !== confirmPassword) {
                    alert('New passwords do not match!');
                    return;
                }
                
                try {
                    const response = await fetch('/api/v1/auth/change-password', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authClient.getToken()}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            current_password: currentPassword,
                            new_password: newPassword
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        alert('Password changed successfully!');
                        document.getElementById('change-password-modal-overlay').classList.add('hidden');
                        changePasswordForm.reset();
                    } else {
                        alert(data.message || 'Failed to change password');
                    }
                } catch (error) {
                    console.error('Error changing password:', error);
                    alert('Failed to change password. Please try again.');
                }
            });
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (userMenuButton && userDropdownMenu) {
                if (!userMenuButton.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                    userDropdownMenu.classList.remove('open');
                }
            }
        });
        
        // Initialize AdminManager
        if (typeof AdminManager !== 'undefined') {
            AdminManager.init();
            window.AdminManager = AdminManager; // Make it available globally
        }
    </script>
</body>
</html>